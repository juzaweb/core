/*
 * AdminLTE v3.2.0 (https://adminlte.io)
 * Copyright 2014-2022 Colorlib <https://colorlib.com>
 * Licensed under MIT (https://github.com/ColorlibHQ/AdminLTE/blob/master/LICENSE)
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("jquery")):"function"==typeof define&&define.amd?define(["exports","jquery"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).adminlte={},e.jQuery)}(this,(function(e,t){"use strict";function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=a(t),i="CardRefresh",o="lte.cardrefresh",l=n.default.fn[i],s="card",r='[data-card-widget="card-refresh"]',d={source:"",sourceSelector:"",params:{},trigger:r,content:".card-body",loadInContent:!0,loadOnInit:!0,loadErrorTemplate:!0,responseType:"",overlayTemplate:'<div class="overlay"><i class="fas fa-2x fa-sync-alt fa-spin"></i></div>',errorTemplate:'<span class="text-danger"></span>',onLoadStart:function(){},onLoadDone:function(e){return e},onLoadFail:function(e,t,a){}},f=function(){function e(e,t){if(this._element=e,this._parent=e.parents(".card").first(),this._settings=n.default.extend({},d,t),this._overlay=n.default(this._settings.overlayTemplate),e.hasClass(s)&&(this._parent=e),""===this._settings.source)throw new Error("Source url was not defined. Please specify a url in your CardRefresh source option.")}var t=e.prototype;return t.load=function(){var e=this;this._addOverlay(),this._settings.onLoadStart.call(n.default(this)),n.default.get(this._settings.source,this._settings.params,(function(t){e._settings.loadInContent&&(""!==e._settings.sourceSelector&&(t=n.default(t).find(e._settings.sourceSelector).html()),e._parent.find(e._settings.content).html(t)),e._settings.onLoadDone.call(n.default(e),t),e._removeOverlay()}),""!==this._settings.responseType&&this._settings.responseType).fail((function(t,a,i){if(e._removeOverlay(),e._settings.loadErrorTemplate){var o=n.default(e._settings.errorTemplate).text(i);e._parent.find(e._settings.content).empty().append(o)}e._settings.onLoadFail.call(n.default(e),t,a,i)})),n.default(this._element).trigger(n.default.Event("loaded.lte.cardrefresh"))},t._addOverlay=function(){this._parent.append(this._overlay),n.default(this._element).trigger(n.default.Event("overlay.added.lte.cardrefresh"))},t._removeOverlay=function(){this._parent.find(this._overlay).remove(),n.default(this._element).trigger(n.default.Event("overlay.removed.lte.cardrefresh"))},t._init=function(){var e=this;n.default(this).find(this._settings.trigger).on("click",(function(){e.load()})),this._settings.loadOnInit&&this.load()},e._jQueryInterface=function(t){var a=n.default(this).data(o),i=n.default.extend({},d,n.default(this).data());a||(a=new e(n.default(this),i),n.default(this).data(o,"string"==typeof t?a:t)),"string"==typeof t&&/load/.test(t)?a[t]():a._init(n.default(this))},e}();n.default(document).on("click",r,(function(e){e&&e.preventDefault(),f._jQueryInterface.call(n.default(this),"load")})),n.default((function(){n.default(r).each((function(){f._jQueryInterface.call(n.default(this))}))})),n.default.fn[i]=f._jQueryInterface,n.default.fn[i].Constructor=f,n.default.fn[i].noConflict=function(){return n.default.fn[i]=l,f._jQueryInterface};var u="CardWidget",c="lte.cardwidget",h=n.default.fn[u],g="card",p="collapsed-card",m="collapsing-card",v="expanding-card",_="was-collapsed",b="maximized-card",y='[data-card-widget="remove"]',C='[data-card-widget="collapse"]',w='[data-card-widget="maximize"]',x={animationSpeed:"normal",collapseTrigger:C,removeTrigger:y,maximizeTrigger:w,collapseIcon:"fa-minus",expandIcon:"fa-plus",maximizeIcon:"fa-expand",minimizeIcon:"fa-compress"},I=function(){function e(e,t){this._element=e,this._parent=e.parents(".card").first(),e.hasClass(g)&&(this._parent=e),this._settings=n.default.extend({},x,t)}var t=e.prototype;return t.collapse=function(){var e=this;this._parent.addClass(m).children(".card-body, .card-footer").slideUp(this._settings.animationSpeed,(function(){e._parent.addClass(p).removeClass(m)})),this._parent.find("> .card-header "+this._settings.collapseTrigger+" ."+this._settings.collapseIcon).addClass(this._settings.expandIcon).removeClass(this._settings.collapseIcon),this._element.trigger(n.default.Event("collapsed.lte.cardwidget"),this._parent)},t.expand=function(){var e=this;this._parent.addClass(v).children(".card-body, .card-footer").slideDown(this._settings.animationSpeed,(function(){e._parent.removeClass(p).removeClass(v)})),this._parent.find("> .card-header "+this._settings.collapseTrigger+" ."+this._settings.expandIcon).addClass(this._settings.collapseIcon).removeClass(this._settings.expandIcon),this._element.trigger(n.default.Event("expanded.lte.cardwidget"),this._parent)},t.remove=function(){this._parent.slideUp(),this._element.trigger(n.default.Event("removed.lte.cardwidget"),this._parent)},t.toggle=function(){this._parent.hasClass(p)?this.expand():this.collapse()},t.maximize=function(){this._parent.find(this._settings.maximizeTrigger+" ."+this._settings.maximizeIcon).addClass(this._settings.minimizeIcon).removeClass(this._settings.maximizeIcon),this._parent.css({height:this._parent.height(),width:this._parent.width(),transition:"all .15s"}).delay(150).queue((function(){var e=n.default(this);e.addClass(b),n.default("html").addClass(b),e.hasClass(p)&&e.addClass(_),e.dequeue()})),this._element.trigger(n.default.Event("maximized.lte.cardwidget"),this._parent)},t.minimize=function(){this._parent.find(this._settings.maximizeTrigger+" ."+this._settings.minimizeIcon).addClass(this._settings.maximizeIcon).removeClass(this._settings.minimizeIcon),this._parent.css("cssText","height: "+this._parent[0].style.height+" !important; width: "+this._parent[0].style.width+" !important; transition: all .15s;").delay(10).queue((function(){var e=n.default(this);e.removeClass(b),n.default("html").removeClass(b),e.css({height:"inherit",width:"inherit"}),e.hasClass(_)&&e.removeClass(_),e.dequeue()})),this._element.trigger(n.default.Event("minimized.lte.cardwidget"),this._parent)},t.toggleMaximize=function(){this._parent.hasClass(b)?this.minimize():this.maximize()},t._init=function(e){var t=this;this._parent=e,n.default(this).find(this._settings.collapseTrigger).click((function(){t.toggle()})),n.default(this).find(this._settings.maximizeTrigger).click((function(){t.toggleMaximize()})),n.default(this).find(this._settings.removeTrigger).click((function(){t.remove()}))},e._jQueryInterface=function(t){var a=n.default(this).data(c),i=n.default.extend({},x,n.default(this).data());a||(a=new e(n.default(this),i),n.default(this).data(c,"string"==typeof t?a:t)),"string"==typeof t&&/collapse|expand|remove|toggle|maximize|minimize|toggleMaximize/.test(t)?a[t]():"object"==typeof t&&a._init(n.default(this))},e}();n.default(document).on("click",C,(function(e){e&&e.preventDefault(),I._jQueryInterface.call(n.default(this),"toggle")})),n.default(document).on("click",y,(function(e){e&&e.preventDefault(),I._jQueryInterface.call(n.default(this),"remove")})),n.default(document).on("click",w,(function(e){e&&e.preventDefault(),I._jQueryInterface.call(n.default(this),"toggleMaximize")})),n.default.fn[u]=I._jQueryInterface,n.default.fn[u].Constructor=I,n.default.fn[u].noConflict=function(){return n.default.fn[u]=h,I._jQueryInterface};var T="ControlSidebar",S="lte.controlsidebar",j=n.default.fn[T],k=".control-sidebar",Q=".control-sidebar-content",H='[data-widget="control-sidebar"]',z=".main-header",F=".main-footer",E="control-sidebar-animate",L="control-sidebar-open",D="control-sidebar-slide-open",R="layout-fixed",A={controlsidebarSlide:!0,scrollbarTheme:"os-theme-light",scrollbarAutoHide:"l",target:k,animationSpeed:300},M=function(){function e(e,t){this._element=e,this._config=t}var t=e.prototype;return t.collapse=function(){var e=this,t=n.default("body"),a=n.default("html");this._config.controlsidebarSlide?(a.addClass(E),t.removeClass(D).delay(300).queue((function(){n.default(k).hide(),a.removeClass(E),n.default(this).dequeue()}))):t.removeClass(L),n.default(this._element).trigger(n.default.Event("collapsed.lte.controlsidebar")),setTimeout((function(){n.default(e._element).trigger(n.default.Event("collapsed-done.lte.controlsidebar"))}),this._config.animationSpeed)},t.show=function(e){void 0===e&&(e=!1);var t=n.default("body"),a=n.default("html");e&&n.default(k).hide(),this._config.controlsidebarSlide?(a.addClass(E),n.default(this._config.target).show().delay(10).queue((function(){t.addClass(D).delay(300).queue((function(){a.removeClass(E),n.default(this).dequeue()})),n.default(this).dequeue()}))):t.addClass(L),this._fixHeight(),this._fixScrollHeight(),n.default(this._element).trigger(n.default.Event("expanded.lte.controlsidebar"))},t.toggle=function(){var e=n.default("body"),t=this._config.target,a=!n.default(t).is(":visible"),i=e.hasClass(L)||e.hasClass(D),o=a&&(e.hasClass(L)||e.hasClass(D));a||o?this.show(a):i&&this.collapse()},t._init=function(){var e=this,t=n.default("body");t.hasClass(L)||t.hasClass(D)?(n.default(k).not(this._config.target).hide(),n.default(this._config.target).css("display","block")):n.default(k).hide(),this._fixHeight(),this._fixScrollHeight(),n.default(window).resize((function(){e._fixHeight(),e._fixScrollHeight()})),n.default(window).scroll((function(){var t=n.default("body");(t.hasClass(L)||t.hasClass(D))&&e._fixScrollHeight()}))},t._isNavbarFixed=function(){var e=n.default("body");return e.hasClass("layout-navbar-fixed")||e.hasClass("layout-sm-navbar-fixed")||e.hasClass("layout-md-navbar-fixed")||e.hasClass("layout-lg-navbar-fixed")||e.hasClass("layout-xl-navbar-fixed")},t._isFooterFixed=function(){var e=n.default("body");return e.hasClass("layout-footer-fixed")||e.hasClass("layout-sm-footer-fixed")||e.hasClass("layout-md-footer-fixed")||e.hasClass("layout-lg-footer-fixed")||e.hasClass("layout-xl-footer-fixed")},t._fixScrollHeight=function(){var e=n.default("body"),t=n.default(this._config.target);if(e.hasClass(R)){var a={scroll:n.default(document).height(),window:n.default(window).height(),header:n.default(z).outerHeight(),footer:n.default(F).outerHeight()},i=Math.abs(a.window+n.default(window).scrollTop()-a.scroll),o=n.default(window).scrollTop(),l=this._isNavbarFixed()&&"fixed"===n.default(z).css("position"),s=this._isFooterFixed()&&"fixed"===n.default(F).css("position"),r=n.default(this._config.target+", "+this._config.target+" "+Q);if(0===o&&0===i)t.css({bottom:a.footer,top:a.header}),r.css("height",a.window-(a.header+a.footer));else if(i<=a.footer)if(!1===s){var d=a.header-o;t.css("bottom",a.footer-i).css("top",d>=0?d:0),r.css("height",a.window-(a.footer-i))}else t.css("bottom",a.footer);else o<=a.header?!1===l?(t.css("top",a.header-o),r.css("height",a.window-(a.header-o))):t.css("top",a.header):!1===l?(t.css("top",0),r.css("height",a.window)):t.css("top",a.header);s&&l?(r.css("height","100%"),t.css("height","")):(s||l)&&(r.css("height","100%"),r.css("height",""))}},t._fixHeight=function(){var e=n.default("body"),t=n.default(this._config.target+" "+Q);if(e.hasClass(R)){var a=n.default(window).height(),i=n.default(z).outerHeight(),o=n.default(F).outerHeight(),l=a-i;this._isFooterFixed()&&"fixed"===n.default(F).css("position")&&(l=a-i-o),t.css("height",l),"undefined"!=typeof n.default.fn.overlayScrollbars&&t.overlayScrollbars({className:this._config.scrollbarTheme,sizeAutoCapable:!0,scrollbars:{autoHide:this._config.scrollbarAutoHide,clickScrolling:!0}})}else t.attr("style","")},e._jQueryInterface=function(t){return this.each((function(){var a=n.default(this).data(S),i=n.default.extend({},A,n.default(this).data());if(a||(a=new e(this,i),n.default(this).data(S,a)),"undefined"===a[t])throw new Error(t+" is not a function");a[t]()}))},e}();n.default(document).on("click",H,(function(e){e.preventDefault(),M._jQueryInterface.call(n.default(this),"toggle")})),n.default(document).ready((function(){M._jQueryInterface.call(n.default(H),"_init")})),n.default.fn[T]=M._jQueryInterface,n.default.fn[T].Constructor=M,n.default.fn[T].noConflict=function(){return n.default.fn[T]=j,M._jQueryInterface};var q="DirectChat",O="lte.directchat",N=n.default.fn[q],P=function(){function e(e){this._element=e}return e.prototype.toggle=function(){n.default(this._element).parents(".direct-chat").first().toggleClass("direct-chat-contacts-open"),n.default(this._element).trigger(n.default.Event("toggled.lte.directchat"))},e._jQueryInterface=function(t){return this.each((function(){var a=n.default(this).data(O);a||(a=new e(n.default(this)),n.default(this).data(O,a)),a[t]()}))},e}();n.default(document).on("click",'[data-widget="chat-pane-toggle"]',(function(e){e&&e.preventDefault(),P._jQueryInterface.call(n.default(this),"toggle")})),n.default.fn[q]=P._jQueryInterface,n.default.fn[q].Constructor=P,n.default.fn[q].noConflict=function(){return n.default.fn[q]=N,P._jQueryInterface};var U="Dropdown",B="lte.dropdown",$=n.default.fn[U],J=".dropdown-menu",W={},V=function(){function e(e,t){this._config=t,this._element=e}var t=e.prototype;return t.toggleSubmenu=function(){this._element.siblings().show().toggleClass("show"),this._element.next().hasClass("show")||this._element.parents(J).first().find(".show").removeClass("show").hide(),this._element.parents("li.nav-item.dropdown.show").on("hidden.bs.dropdown",(function(){n.default(".dropdown-submenu .show").removeClass("show").hide()}))},t.fixPosition=function(){var e=n.default(".dropdown-menu.show");if(0!==e.length){e.hasClass("dropdown-menu-right")?e.css({left:"inherit",right:0}):e.css({left:0,right:"inherit"});var t=e.offset(),a=e.width(),i=n.default(window).width()-t.left;t.left<0?e.css({left:"inherit",right:t.left-5}):i<a&&e.css({left:"inherit",right:0})}},e._jQueryInterface=function(t){return this.each((function(){var a=n.default(this).data(B),i=n.default.extend({},W,n.default(this).data());a||(a=new e(n.default(this),i),n.default(this).data(B,a)),"toggleSubmenu"!==t&&"fixPosition"!==t||a[t]()}))},e}();n.default('.dropdown-menu [data-toggle="dropdown"]').on("click",(function(e){e.preventDefault(),e.stopPropagation(),V._jQueryInterface.call(n.default(this),"toggleSubmenu")})),n.default('.navbar [data-toggle="dropdown"]').on("click",(function(e){e.preventDefault(),n.default(e.target).parent().hasClass("dropdown-submenu")||setTimeout((function(){V._jQueryInterface.call(n.default(this),"fixPosition")}),1)})),n.default.fn[U]=V._jQueryInterface,n.default.fn[U].Constructor=V,n.default.fn[U].noConflict=function(){return n.default.fn[U]=$,V._jQueryInterface};var G="ExpandableTable",K="lte.expandableTable",X=n.default.fn[G],Y=".expandable-body",Z='[data-widget="expandable-table"]',ee="aria-expanded",te=function(){function e(e,t){this._options=t,this._element=e}var t=e.prototype;return t.init=function(){n.default(Z).each((function(e,t){var a=n.default(t).attr(ee),i=n.default(t).next(Y).children().first().children();"true"===a?i.show():"false"===a&&(i.hide(),i.parent().parent().addClass("d-none"))}))},t.toggleRow=function(){var e=this._element;"TR"!==e[0].nodeName&&"TR"!==(e=e.parent())[0].nodeName&&(e=e.parent());var t=e.attr(ee),a=e.next(Y).children().first().children();a.stop(),"true"===t?(a.slideUp(500,(function(){e.next(Y).addClass("d-none")})),e.attr(ee,"false"),e.trigger(n.default.Event("collapsed.lte.expandableTable"))):"false"===t&&(e.next(Y).removeClass("d-none"),a.slideDown(500),e.attr(ee,"true"),e.trigger(n.default.Event("expanded.lte.expandableTable")))},e._jQueryInterface=function(t){return this.each((function(){var a=n.default(this).data(K);a||(a=new e(n.default(this)),n.default(this).data(K,a)),"string"==typeof t&&/init|toggleRow/.test(t)&&a[t]()}))},e}();n.default(".expandable-table").ready((function(){te._jQueryInterface.call(n.default(this),"init")})),n.default(document).on("click",Z,(function(){te._jQueryInterface.call(n.default(this),"toggleRow")})),n.default.fn[G]=te._jQueryInterface,n.default.fn[G].Constructor=te,n.default.fn[G].noConflict=function(){return n.default.fn[G]=X,te._jQueryInterface};var ae="Fullscreen",ne="lte.fullscreen",ie=n.default.fn[ae],oe='[data-widget="fullscreen"]',le=oe+" i",se={minimizeIcon:"fa-compress-arrows-alt",maximizeIcon:"fa-expand-arrows-alt"},re=function(){function e(e,t){this.element=e,this.options=n.default.extend({},se,t)}var t=e.prototype;return t.toggle=function(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?this.windowed():this.fullscreen()},t.toggleIcon=function(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?n.default(le).removeClass(this.options.maximizeIcon).addClass(this.options.minimizeIcon):n.default(le).removeClass(this.options.minimizeIcon).addClass(this.options.maximizeIcon)},t.fullscreen=function(){document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.msRequestFullscreen&&document.documentElement.msRequestFullscreen()},t.windowed=function(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},e._jQueryInterface=function(t){var a=n.default(this).data(ne);a||(a=n.default(this).data());var i=n.default.extend({},se,"object"==typeof t?t:a),o=new e(n.default(this),i);n.default(this).data(ne,"object"==typeof t?t:a),"string"==typeof t&&/toggle|toggleIcon|fullscreen|windowed/.test(t)?o[t]():o.init()},e}();n.default(document).on("click",oe,(function(){re._jQueryInterface.call(n.default(this),"toggle")})),n.default(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",(function(){re._jQueryInterface.call(n.default(oe),"toggleIcon")})),n.default.fn[ae]=re._jQueryInterface,n.default.fn[ae].Constructor=re,n.default.fn[ae].noConflict=function(){return n.default.fn[ae]=ie,re._jQueryInterface};var de="lte.iframe",fe=n.default.fn.IFrame,ue='[data-widget="iframe"]',ce='[data-widget="iframe-fullscreen"]',he=".content-wrapper",ge=".content-wrapper iframe",pe=".content-wrapper.iframe-mode .nav",me=".content-wrapper.iframe-mode .navbar-nav",ve=me+" .nav-item",_e=me+" .nav-link",be=".content-wrapper.iframe-mode .tab-content",ye=be+" .tab-empty",Ce=be+" .tab-loading",we=be+" .tab-pane",xe=".main-sidebar .nav-item > a.nav-link",Ie=".main-header .nav-item a.nav-link",Te=".main-header a.dropdown-item",Se="iframe-mode",je="iframe-mode-fullscreen",ke={onTabClick:function(e){return e},onTabChanged:function(e){return e},onTabCreated:function(e){return e},autoIframeMode:!0,autoItemActive:!0,autoShowNewTab:!0,autoDarkMode:!1,allowDuplicates:!1,allowReload:!0,loadingScreen:!0,useNavbarItems:!0,scrollOffset:40,scrollBehaviorSwap:!1,iconMaximize:"fa-expand",iconMinimize:"fa-compress"},Qe=function(){function e(e,t){this._config=t,this._element=e,this._init()}var t=e.prototype;return t.onTabClick=function(e){this._config.onTabClick(e)},t.onTabChanged=function(e){this._config.onTabChanged(e)},t.onTabCreated=function(e){this._config.onTabCreated(e)},t.createTab=function(e,t,a,i){var o=this,l="panel-"+a,s="tab-"+a;this._config.allowDuplicates&&(l+="-"+Math.floor(1e3*Math.random()),s+="-"+Math.floor(1e3*Math.random()));var r='<li class="nav-item" role="presentation"><a href="#" class="btn-iframe-close" data-widget="iframe-close" data-type="only-this"><i class="fas fa-times"></i></a><a class="nav-link" data-toggle="row" id="'+s+'" href="#'+l+'" role="tab" aria-controls="'+l+'" aria-selected="false">'+e+"</a></li>";n.default(me).append(unescape(escape(r)));var d='<div class="tab-pane fade" id="'+l+'" role="tabpanel" aria-labelledby="'+s+'"><iframe src="'+t+'"></iframe></div>';if(n.default(be).append(unescape(escape(d))),i)if(this._config.loadingScreen){var f=n.default(Ce);f.fadeIn(),n.default(l+" iframe").ready((function(){"number"==typeof o._config.loadingScreen?(o.switchTab("#"+s),setTimeout((function(){f.fadeOut()}),o._config.loadingScreen)):(o.switchTab("#"+s),f.fadeOut())}))}else this.switchTab("#"+s);this.onTabCreated(n.default("#"+s))},t.openTabSidebar=function(e,t){void 0===t&&(t=this._config.autoShowNewTab);var a=n.default(e).clone();void 0===a.attr("href")&&(a=n.default(e).parent("a").clone()),a.find(".right, .search-path").remove();var i=a.find("p").text();""===i&&(i=a.text());var o=a.attr("href");if("#"!==o&&""!==o&&void 0!==o){var l=unescape(o).replace("./","").replace(/["#&'./:=?[\]]/gi,"-").replace(/(--)/gi,""),s="tab-"+l;if(!this._config.allowDuplicates&&n.default("#"+s).length>0)return this.switchTab("#"+s,this._config.allowReload);(!this._config.allowDuplicates&&0===n.default("#"+s).length||this._config.allowDuplicates)&&this.createTab(i,o,l,t)}},t.switchTab=function(e,t){var a=this;void 0===t&&(t=!1);var i=n.default(e),o=i.attr("href");if(n.default(ye).hide(),t){var l=n.default(Ce);this._config.loadingScreen?l.show(0,(function(){n.default(o+" iframe").attr("src",n.default(o+" iframe").attr("src")).ready((function(){a._config.loadingScreen&&("number"==typeof a._config.loadingScreen?setTimeout((function(){l.fadeOut()}),a._config.loadingScreen):l.fadeOut())}))})):n.default(o+" iframe").attr("src",n.default(o+" iframe").attr("src"))}n.default(me+" .active").tab("dispose").removeClass("active"),this._fixHeight(),i.tab("show"),i.parents("li").addClass("active"),this.onTabChanged(i),this._config.autoItemActive&&this._setItemActive(n.default(o+" iframe").attr("src"))},t.removeActiveTab=function(e,t){if("all"==e)n.default(ve).remove(),n.default(we).remove(),n.default(ye).show();else if("all-other"==e)n.default(ve+":not(.active)").remove(),n.default(we+":not(.active)").remove();else if("only-this"==e){var a=n.default(t),i=a.parent(".nav-item"),o=i.parent(),l=i.index(),s=a.siblings(".nav-link").attr("aria-controls");if(i.remove(),n.default("#"+s).remove(),n.default(be).children().length==n.default(ye+", "+Ce).length)n.default(ye).show();else{var r=l-1;this.switchTab(o.children().eq(r).find("a.nav-link"))}}else{var d=n.default(ve+".active"),f=d.parent(),u=d.index();if(d.remove(),n.default(we+".active").remove(),n.default(be).children().length==n.default(ye+", "+Ce).length)n.default(ye).show();else{var c=u-1;this.switchTab(f.children().eq(c).find("a.nav-link"))}}},t.toggleFullscreen=function(){n.default("body").hasClass(je)?(n.default(ce+" i").removeClass(this._config.iconMinimize).addClass(this._config.iconMaximize),n.default("body").removeClass(je),n.default(ye+", "+Ce).height("100%"),n.default(he).height("100%"),n.default(ge).height("100%")):(n.default(ce+" i").removeClass(this._config.iconMaximize).addClass(this._config.iconMinimize),n.default("body").addClass(je)),n.default(window).trigger("resize"),this._fixHeight(!0)},t._init=function(){var e=n.default(be).children().length>2;if(this._setupListeners(),this._fixHeight(!0),e){var t=n.default(""+we).first();console.log(t);var a="#tab-"+t.attr("id").replace("panel-","");this.switchTab(a,!0)}},t._initFrameElement=function(){if(window.frameElement&&this._config.autoIframeMode){var e=n.default("body");e.addClass(Se),this._config.autoDarkMode&&e.addClass("dark-mode")}},t._navScroll=function(e){var t=n.default(me).scrollLeft();n.default(me).animate({scrollLeft:t+e},250,"linear")},t._setupListeners=function(){var e=this;n.default(window).on("resize",(function(){setTimeout((function(){e._fixHeight()}),1)})),n.default(he).hasClass(Se)&&(n.default(document).on("click",xe+", .sidebar-search-results .list-group-item",(function(t){t.preventDefault(),e.openTabSidebar(t.target)})),this._config.useNavbarItems&&n.default(document).on("click",Ie+", "+Te,(function(t){t.preventDefault(),e.openTabSidebar(t.target)}))),n.default(document).on("click",_e,(function(t){t.preventDefault(),e.onTabClick(t.target),e.switchTab(t.target)})),n.default(document).on("click",_e,(function(t){t.preventDefault(),e.onTabClick(t.target),e.switchTab(t.target)})),n.default(document).on("click",'[data-widget="iframe-close"]',(function(t){t.preventDefault();var a=t.target;"I"==a.nodeName&&(a=t.target.offsetParent),e.removeActiveTab(a.attributes["data-type"]?a.attributes["data-type"].nodeValue:null,a)})),n.default(document).on("click",ce,(function(t){t.preventDefault(),e.toggleFullscreen()}));var t=!1,a=null;n.default(document).on("mousedown",'[data-widget="iframe-scrollleft"]',(function(n){n.preventDefault(),clearInterval(a);var i=e._config.scrollOffset;e._config.scrollBehaviorSwap||(i=-i),t=!0,e._navScroll(i),a=setInterval((function(){e._navScroll(i)}),250)})),n.default(document).on("mousedown",'[data-widget="iframe-scrollright"]',(function(n){n.preventDefault(),clearInterval(a);var i=e._config.scrollOffset;e._config.scrollBehaviorSwap&&(i=-i),t=!0,e._navScroll(i),a=setInterval((function(){e._navScroll(i)}),250)})),n.default(document).on("mouseup",(function(){t&&(t=!1,clearInterval(a),a=null)}))},t._setItemActive=function(e){n.default(xe+", "+Te).removeClass("active"),n.default(Ie).parent().removeClass("active");var t=n.default(Ie+'[href$="'+e+'"]'),a=n.default('.main-header a.dropdown-item[href$="'+e+'"]'),i=n.default(xe+'[href$="'+e+'"]');t.each((function(e,t){n.default(t).parent().addClass("active")})),a.each((function(e,t){n.default(t).addClass("active")})),i.each((function(e,t){n.default(t).addClass("active"),n.default(t).parents(".nav-treeview").prevAll(".nav-link").addClass("active")}))},t._fixHeight=function(e){if(void 0===e&&(e=!1),n.default("body").hasClass(je)){var t=n.default(window).height(),a=n.default(pe).outerHeight();n.default(ye+", "+Ce+", "+ge).height(t-a),n.default(he).height(t)}else{var i=parseFloat(n.default(he).css("height")),o=n.default(pe).outerHeight();1==e?setTimeout((function(){n.default(ye+", "+Ce).height(i-o)}),50):n.default(ge).height(i-o)}},e._jQueryInterface=function(t){if(n.default(ue).length>0){var a=n.default(this).data(de);a||(a=n.default(this).data());var i=n.default.extend({},ke,"object"==typeof t?t:a);localStorage.setItem("AdminLTE:IFrame:Options",JSON.stringify(i));var o=new e(n.default(this),i);n.default(this).data(de,"object"==typeof t?t:a),"string"==typeof t&&/createTab|openTabSidebar|switchTab|removeActiveTab/.test(t)&&o[t]()}else new e(n.default(this),JSON.parse(localStorage.getItem("AdminLTE:IFrame:Options")))._initFrameElement()},e}();n.default(window).on("load",(function(){Qe._jQueryInterface.call(n.default(ue))})),n.default.fn.IFrame=Qe._jQueryInterface,n.default.fn.IFrame.Constructor=Qe,n.default.fn.IFrame.noConflict=function(){return n.default.fn.IFrame=fe,Qe._jQueryInterface};var He="lte.layout",ze=n.default.fn.Layout,Fe=".main-header",Ee=".main-sidebar",Le=".main-sidebar .sidebar",De=".main-footer",Re="sidebar-focused",Ae={scrollbarTheme:"os-theme-light",scrollbarAutoHide:"l",panelAutoHeight:!0,panelAutoHeightMode:"min-height",preloadDuration:200,loginRegisterAutoHeight:!0},Me=function(){function e(e,t){this._config=t,this._element=e}var t=e.prototype;return t.fixLayoutHeight=function(e){void 0===e&&(e=null);var t=n.default("body"),a=0;(t.hasClass("control-sidebar-slide-open")||t.hasClass("control-sidebar-open")||"control_sidebar"===e)&&(a=n.default(".control-sidebar-content").outerHeight());var i={window:n.default(window).height(),header:n.default(Fe).length>0?n.default(Fe).outerHeight():0,footer:n.default(De).length>0?n.default(De).outerHeight():0,sidebar:n.default(Le).length>0?n.default(Le).height():0,controlSidebar:a},o=this._max(i),l=this._config.panelAutoHeight;!0===l&&(l=0);var s=n.default(".content-wrapper");!1!==l&&(o===i.controlSidebar?s.css(this._config.panelAutoHeightMode,o+l):o===i.window?s.css(this._config.panelAutoHeightMode,o+l-i.header-i.footer):s.css(this._config.panelAutoHeightMode,o+l-i.header),this._isFooterFixed()&&s.css(this._config.panelAutoHeightMode,parseFloat(s.css(this._config.panelAutoHeightMode))+i.footer)),t.hasClass("layout-fixed")&&("undefined"!=typeof n.default.fn.overlayScrollbars?n.default(Le).overlayScrollbars({className:this._config.scrollbarTheme,sizeAutoCapable:!0,scrollbars:{autoHide:this._config.scrollbarAutoHide,clickScrolling:!0}}):n.default(Le).css("overflow-y","auto"))},t.fixLoginRegisterHeight=function(){var e=n.default("body"),t=n.default(".login-box, .register-box");if(e.hasClass("iframe-mode"))e.css("height","100%"),n.default(".wrapper").css("height","100%"),n.default("html").css("height","100%");else if(0===t.length)e.css("height","auto"),n.default("html").css("height","auto");else{var a=t.height();e.css(this._config.panelAutoHeightMode)!==a&&e.css(this._config.panelAutoHeightMode,a)}},t._init=function(){var e=this;this.fixLayoutHeight(),!0===this._config.loginRegisterAutoHeight?this.fixLoginRegisterHeight():this._config.loginRegisterAutoHeight===parseInt(this._config.loginRegisterAutoHeight,10)&&setInterval(this.fixLoginRegisterHeight,this._config.loginRegisterAutoHeight),n.default(Le).on("collapsed.lte.treeview expanded.lte.treeview",(function(){e.fixLayoutHeight()})),n.default(Ee).on("mouseenter mouseleave",(function(){n.default("body").hasClass("sidebar-collapse")&&e.fixLayoutHeight()})),n.default('[data-widget="pushmenu"]').on("collapsed.lte.pushmenu shown.lte.pushmenu",(function(){setTimeout((function(){e.fixLayoutHeight()}),300)})),n.default('[data-widget="control-sidebar"]').on("collapsed.lte.controlsidebar",(function(){e.fixLayoutHeight()})).on("expanded.lte.controlsidebar",(function(){e.fixLayoutHeight("control_sidebar")})),n.default(window).resize((function(){e.fixLayoutHeight()})),setTimeout((function(){n.default("body.hold-transition").removeClass("hold-transition")}),50),setTimeout((function(){var e=n.default(".preloader");e&&(e.css("height",0),setTimeout((function(){e.children().hide()}),200))}),this._config.preloadDuration)},t._max=function(e){var t=0;return Object.keys(e).forEach((function(a){e[a]>t&&(t=e[a])})),t},t._isFooterFixed=function(){return"fixed"===n.default(De).css("position")},e._jQueryInterface=function(t){return void 0===t&&(t=""),this.each((function(){var a=n.default(this).data(He),i=n.default.extend({},Ae,n.default(this).data());a||(a=new e(n.default(this),i),n.default(this).data(He,a)),"init"===t||""===t?a._init():"fixLayoutHeight"!==t&&"fixLoginRegisterHeight"!==t||a[t]()}))},e}();n.default(window).on("load",(function(){Me._jQueryInterface.call(n.default("body"))})),n.default(Le+" a").on("focusin",(function(){n.default(Ee).addClass(Re)})).on("focusout",(function(){n.default(Ee).removeClass(Re)})),n.default.fn.Layout=Me._jQueryInterface,n.default.fn.Layout.Constructor=Me,n.default.fn.Layout.noConflict=function(){return n.default.fn.Layout=ze,Me._jQueryInterface};var qe="PushMenu",Oe="lte.pushmenu",Ne="."+Oe,Pe=n.default.fn[qe],Ue='[data-widget="pushmenu"]',Be="body",$e="sidebar-collapse",Je="sidebar-open",We="sidebar-is-opening",Ve="sidebar-closed",Ge={autoCollapseSize:992,enableRemember:!1,noTransitionAfterReload:!0,animationSpeed:300},Ke=function(){function e(e,t){this._element=e,this._options=n.default.extend({},Ge,t),0===n.default("#sidebar-overlay").length&&this._addOverlay(),this._init()}var t=e.prototype;return t.expand=function(){var e=n.default(Be);this._options.autoCollapseSize&&n.default(window).width()<=this._options.autoCollapseSize&&e.addClass(Je),e.addClass(We).removeClass("sidebar-collapse sidebar-closed").delay(50).queue((function(){e.removeClass(We),n.default(this).dequeue()})),this._options.enableRemember&&localStorage.setItem("remember"+Ne,Je),n.default(this._element).trigger(n.default.Event("shown.lte.pushmenu"))},t.collapse=function(){var e=this,t=n.default(Be);this._options.autoCollapseSize&&n.default(window).width()<=this._options.autoCollapseSize&&t.removeClass(Je).addClass(Ve),t.addClass($e),this._options.enableRemember&&localStorage.setItem("remember"+Ne,$e),n.default(this._element).trigger(n.default.Event("collapsed.lte.pushmenu")),setTimeout((function(){n.default(e._element).trigger(n.default.Event("collapsed-done.lte.pushmenu"))}),this._options.animationSpeed)},t.toggle=function(){n.default(Be).hasClass($e)?this.expand():this.collapse()},t.autoCollapse=function(e){if(void 0===e&&(e=!1),this._options.autoCollapseSize){var t=n.default(Be);n.default(window).width()<=this._options.autoCollapseSize?t.hasClass(Je)||this.collapse():!0===e&&(t.hasClass(Je)?t.removeClass(Je):t.hasClass(Ve)&&this.expand())}},t.remember=function(){if(this._options.enableRemember){var e=n.default("body");localStorage.getItem("remember"+Ne)===$e?this._options.noTransitionAfterReload?e.addClass("hold-transition").addClass($e).delay(50).queue((function(){n.default(this).removeClass("hold-transition"),n.default(this).dequeue()})):e.addClass($e):this._options.noTransitionAfterReload?e.addClass("hold-transition").removeClass($e).delay(50).queue((function(){n.default(this).removeClass("hold-transition"),n.default(this).dequeue()})):e.removeClass($e)}},t._init=function(){var e=this;this.remember(),this.autoCollapse(),n.default(window).resize((function(){e.autoCollapse(!0)}))},t._addOverlay=function(){var e=this,t=n.default("<div />",{id:"sidebar-overlay"});t.on("click",(function(){e.collapse()})),n.default(".wrapper").append(t)},e._jQueryInterface=function(t){return this.each((function(){var a=n.default(this).data(Oe),i=n.default.extend({},Ge,n.default(this).data());a||(a=new e(this,i),n.default(this).data(Oe,a)),"string"==typeof t&&/collapse|expand|toggle/.test(t)&&a[t]()}))},e}();n.default(document).on("click",Ue,(function(e){e.preventDefault();var t=e.currentTarget;"pushmenu"!==n.default(t).data("widget")&&(t=n.default(t).closest(Ue)),Ke._jQueryInterface.call(n.default(t),"toggle")})),n.default(window).on("load",(function(){Ke._jQueryInterface.call(n.default(Ue))})),n.default.fn[qe]=Ke._jQueryInterface,n.default.fn[qe].Constructor=Ke,n.default.fn[qe].noConflict=function(){return n.default.fn[qe]=Pe,Ke._jQueryInterface};var Xe="SidebarSearch",Ye="lte.sidebar-search",Ze=n.default.fn[Xe],et="sidebar-search-open",tt="fa-search",at="fa-times",nt="sidebar-search-results",it="list-group",ot='[data-widget="sidebar-search"]',lt=ot+" .form-control",st=ot+" .btn",rt=st+" i",dt=".sidebar-search-results",ft=".sidebar-search-results .list-group",ut={arrowSign:"->",minLength:3,maxResults:7,highlightName:!0,highlightPath:!1,highlightClass:"text-light",notFoundText:"No element found!"},ct=[],ht=function(){function e(e,t){this.element=e,this.options=n.default.extend({},ut,t),this.items=[]}var a=e.prototype;return a.init=function(){var e=this;0!==n.default(ot).length&&(0===n.default(ot).next(dt).length&&n.default(ot).after(n.default("<div />",{class:nt})),0===n.default(dt).children(".list-group").length&&n.default(dt).append(n.default("<div />",{class:it})),this._addNotFound(),n.default(".main-sidebar .nav-sidebar").children().each((function(t,a){e._parseItem(a)})))},a.search=function(){var e=this,t=n.default(lt).val().toLowerCase();if(t.length<this.options.minLength)return n.default(ft).empty(),this._addNotFound(),void this.close();var a=ct.filter((function(e){return e.name.toLowerCase().includes(t)})),i=n.default(a.slice(0,this.options.maxResults));n.default(ft).empty(),0===i.length?this._addNotFound():i.each((function(t,a){n.default(ft).append(e._renderItem(escape(a.name),encodeURI(a.link),a.path))})),this.open()},a.open=function(){n.default(ot).parent().addClass(et),n.default(rt).removeClass(tt).addClass(at)},a.close=function(){n.default(ot).parent().removeClass(et),n.default(rt).removeClass(at).addClass(tt)},a.toggle=function(){n.default(ot).parent().hasClass(et)?this.close():this.open()},a._parseItem=function(e,t){var a=this;if(void 0===t&&(t=[]),!n.default(e).hasClass("nav-header")){var i={},o=n.default(e).clone().find("> .nav-link"),l=n.default(e).clone().find("> .nav-treeview"),s=o.attr("href"),r=o.find("p").children().remove().end().text();if(i.name=this._trimText(r),i.link=s,i.path=t,0===l.length)ct.push(i);else{var d=i.path.concat([i.name]);l.children().each((function(e,t){a._parseItem(t,d)}))}}},a._trimText=function(e){return t.trim(e.replace(/(\r\n|\n|\r)/gm," "))},a._renderItem=function(e,t,a){var i=this;if(a=a.join(" "+this.options.arrowSign+" "),e=unescape(e),t=decodeURI(t),this.options.highlightName||this.options.highlightPath){var o=n.default(lt).val().toLowerCase(),l=new RegExp(o,"gi");this.options.highlightName&&(e=e.replace(l,(function(e){return'<strong class="'+i.options.highlightClass+'">'+e+"</strong>"}))),this.options.highlightPath&&(a=a.replace(l,(function(e){return'<strong class="'+i.options.highlightClass+'">'+e+"</strong>"})))}var s=n.default("<a/>",{href:decodeURIComponent(t),class:"list-group-item"}),r=n.default("<div/>",{class:"search-title"}).html(e),d=n.default("<div/>",{class:"search-path"}).html(a);return s.append(r).append(d),s},a._addNotFound=function(){n.default(ft).append(this._renderItem(this.options.notFoundText,"#",[]))},e._jQueryInterface=function(t){var a=n.default(this).data(Ye);a||(a=n.default(this).data());var i=n.default.extend({},ut,"object"==typeof t?t:a),o=new e(n.default(this),i);n.default(this).data(Ye,"object"==typeof t?t:a),"string"==typeof t&&/init|toggle|close|open|search/.test(t)?o[t]():o.init()},e}();n.default(document).on("click",st,(function(e){e.preventDefault(),ht._jQueryInterface.call(n.default(ot),"toggle")})),n.default(document).on("keyup",lt,(function(e){return 38==e.keyCode?(e.preventDefault(),void n.default(ft).children().last().focus()):40==e.keyCode?(e.preventDefault(),void n.default(ft).children().first().focus()):void setTimeout((function(){ht._jQueryInterface.call(n.default(ot),"search")}),100)})),n.default(document).on("keydown",ft,(function(e){var t=n.default(":focus");38==e.keyCode&&(e.preventDefault(),t.is(":first-child")?t.siblings().last().focus():t.prev().focus()),40==e.keyCode&&(e.preventDefault(),t.is(":last-child")?t.siblings().first().focus():t.next().focus())})),n.default(window).on("load",(function(){ht._jQueryInterface.call(n.default(ot),"init")})),n.default.fn[Xe]=ht._jQueryInterface,n.default.fn[Xe].Constructor=ht,n.default.fn[Xe].noConflict=function(){return n.default.fn[Xe]=Ze,ht._jQueryInterface};var gt="NavbarSearch",pt="lte.navbar-search",mt=n.default.fn[gt],vt='[data-widget="navbar-search"]',_t=".form-control",bt="navbar-search-open",yt={resetOnClose:!0,target:".navbar-search-block"},Ct=function(){function e(e,t){this._element=e,this._config=n.default.extend({},yt,t)}var t=e.prototype;return t.open=function(){n.default(this._config.target).css("display","flex").hide().fadeIn().addClass(bt),n.default(this._config.target+" "+_t).focus()},t.close=function(){n.default(this._config.target).fadeOut().removeClass(bt),this._config.resetOnClose&&n.default(this._config.target+" "+_t).val("")},t.toggle=function(){n.default(this._config.target).hasClass(bt)?this.close():this.open()},e._jQueryInterface=function(t){return this.each((function(){var a=n.default(this).data(pt),i=n.default.extend({},yt,n.default(this).data());if(a||(a=new e(this,i),n.default(this).data(pt,a)),!/toggle|close|open/.test(t))throw new Error("Undefined method "+t);a[t]()}))},e}();n.default(document).on("click",vt,(function(e){e.preventDefault();var t=n.default(e.currentTarget);"navbar-search"!==t.data("widget")&&(t=t.closest(vt)),Ct._jQueryInterface.call(t,"toggle")})),n.default.fn[gt]=Ct._jQueryInterface,n.default.fn[gt].Constructor=Ct,n.default.fn[gt].noConflict=function(){return n.default.fn[gt]=mt,Ct._jQueryInterface};var wt=n.default.fn.Toasts,xt="topRight",It="topLeft",Tt="bottomRight",St="bottomLeft",jt={position:xt,fixed:!0,autohide:!1,autoremove:!0,delay:1e3,fade:!0,icon:null,image:null,imageAlt:null,imageHeight:"25px",title:null,subtitle:null,close:!0,body:null,class:null},kt=function(){function e(e,t){this._config=t,this._prepareContainer(),n.default("body").trigger(n.default.Event("init.lte.toasts"))}var t=e.prototype;return t.create=function(){var e=n.default('<div class="toast" role="alert" aria-live="assertive" aria-atomic="true"/>');e.data("autohide",this._config.autohide),e.data("animation",this._config.fade),this._config.class&&e.addClass(this._config.class),this._config.delay&&500!=this._config.delay&&e.data("delay",this._config.delay);var t=n.default('<div class="toast-header">');if(null!=this._config.image){var a=n.default("<img />").addClass("rounded mr-2").attr("src",this._config.image).attr("alt",this._config.imageAlt);null!=this._config.imageHeight&&a.height(this._config.imageHeight).width("auto"),t.append(a)}if(null!=this._config.icon&&t.append(n.default("<i />").addClass("mr-2").addClass(this._config.icon)),null!=this._config.title&&t.append(n.default("<strong />").addClass("mr-auto").html(this._config.title)),null!=this._config.subtitle&&t.append(n.default("<small />").html(this._config.subtitle)),1==this._config.close){var i=n.default('<button data-dismiss="toast" />').attr("type","button").addClass("ml-2 mb-1 close").attr("aria-label","Close").append('<span aria-hidden="true">&times;</span>');null==this._config.title&&i.toggleClass("ml-2 ml-auto"),t.append(i)}e.append(t),null!=this._config.body&&e.append(n.default('<div class="toast-body" />').html(this._config.body)),n.default(this._getContainerId()).prepend(e);var o=n.default("body");o.trigger(n.default.Event("created.lte.toasts")),e.toast("show"),this._config.autoremove&&e.on("hidden.bs.toast",(function(){n.default(this).delay(200).remove(),o.trigger(n.default.Event("removed.lte.toasts"))}))},t._getContainerId=function(){return this._config.position==xt?"#toastsContainerTopRight":this._config.position==It?"#toastsContainerTopLeft":this._config.position==Tt?"#toastsContainerBottomRight":this._config.position==St?"#toastsContainerBottomLeft":void 0},t._prepareContainer=function(){if(0===n.default(this._getContainerId()).length){var e=n.default("<div />").attr("id",this._getContainerId().replace("#",""));this._config.position==xt?e.addClass("toasts-top-right"):this._config.position==It?e.addClass("toasts-top-left"):this._config.position==Tt?e.addClass("toasts-bottom-right"):this._config.position==St&&e.addClass("toasts-bottom-left"),n.default("body").append(e)}this._config.fixed?n.default(this._getContainerId()).addClass("fixed"):n.default(this._getContainerId()).removeClass("fixed")},e._jQueryInterface=function(t,a){return this.each((function(){var i=n.default.extend({},jt,a),o=new e(n.default(this),i);"create"===t&&o[t]()}))},e}();n.default.fn.Toasts=kt._jQueryInterface,n.default.fn.Toasts.Constructor=kt,n.default.fn.Toasts.noConflict=function(){return n.default.fn.Toasts=wt,kt._jQueryInterface};var Qt="TodoList",Ht="lte.todolist",zt=n.default.fn[Qt],Ft="done",Et={onCheck:function(e){return e},onUnCheck:function(e){return e}},Lt=function(){function e(e,t){this._config=t,this._element=e,this._init()}var t=e.prototype;return t.toggle=function(e){e.parents("li").toggleClass(Ft),n.default(e).prop("checked")?this.check(e):this.unCheck(n.default(e))},t.check=function(e){this._config.onCheck.call(e)},t.unCheck=function(e){this._config.onUnCheck.call(e)},t._init=function(){var e=this,t=this._element;t.find("input:checkbox:checked").parents("li").toggleClass(Ft),t.on("change","input:checkbox",(function(t){e.toggle(n.default(t.target))}))},e._jQueryInterface=function(t){return this.each((function(){var a=n.default(this).data(Ht);a||(a=n.default(this).data());var i=n.default.extend({},Et,"object"==typeof t?t:a),o=new e(n.default(this),i);n.default(this).data(Ht,"object"==typeof t?t:a),"init"===t&&o[t]()}))},e}();n.default(window).on("load",(function(){Lt._jQueryInterface.call(n.default('[data-widget="todo-list"]'))})),n.default.fn[Qt]=Lt._jQueryInterface,n.default.fn[Qt].Constructor=Lt,n.default.fn[Qt].noConflict=function(){return n.default.fn[Qt]=zt,Lt._jQueryInterface};var Dt="Treeview",Rt="lte.treeview",At=n.default.fn[Dt],Mt=".nav-item",qt=".nav-treeview",Ot=".menu-open",Nt='[data-widget="treeview"]',Pt="menu-open",Ut="menu-is-opening",Bt={trigger:Nt+" .nav-link",animationSpeed:300,accordion:!0,expandSidebar:!1,sidebarButtonSelector:'[data-widget="pushmenu"]'},$t=function(){function e(e,t){this._config=t,this._element=e}var t=e.prototype;return t.init=function(){n.default(".nav-item.menu-open .nav-treeview.menu-open").css("display","block"),this._setupListeners()},t.expand=function(e,t){var a=this,i=n.default.Event("expanded.lte.treeview");if(this._config.accordion){var o=t.siblings(Ot).first(),l=o.find(qt).first();this.collapse(l,o)}t.addClass(Ut),e.stop().slideDown(this._config.animationSpeed,(function(){t.addClass(Pt),n.default(a._element).trigger(i)})),this._config.expandSidebar&&this._expandSidebar()},t.collapse=function(e,t){var a=this,i=n.default.Event("collapsed.lte.treeview");t.removeClass("menu-is-opening menu-open"),e.stop().slideUp(this._config.animationSpeed,(function(){n.default(a._element).trigger(i),e.find(".menu-open > .nav-treeview").slideUp(),e.find(Ot).removeClass("menu-is-opening menu-open")}))},t.toggle=function(e){var t=n.default(e.currentTarget),a=t.parent(),i=a.find("> .nav-treeview");if(i.is(qt)||(a.is(Mt)||(i=a.parent().find("> .nav-treeview")),i.is(qt))){e.preventDefault();var o=t.parents(Mt).first();o.hasClass(Pt)?this.collapse(n.default(i),o):this.expand(n.default(i),o)}},t._setupListeners=function(){var e=this,t=void 0!==this._element.attr("id")?"#"+this._element.attr("id"):"";n.default(document).on("click",""+t+this._config.trigger,(function(t){e.toggle(t)}))},t._expandSidebar=function(){n.default("body").hasClass("sidebar-collapse")&&n.default(this._config.sidebarButtonSelector).PushMenu("expand")},e._jQueryInterface=function(t){return this.each((function(){var a=n.default(this).data(Rt),i=n.default.extend({},Bt,n.default(this).data());a||(a=new e(n.default(this),i),n.default(this).data(Rt,a)),"init"===t&&a[t]()}))},e}();n.default(window).on("load.lte.treeview",(function(){n.default(Nt).each((function(){$t._jQueryInterface.call(n.default(this),"init")}))})),n.default.fn[Dt]=$t._jQueryInterface,n.default.fn[Dt].Constructor=$t,n.default.fn[Dt].noConflict=function(){return n.default.fn[Dt]=At,$t._jQueryInterface},e.CardRefresh=f,e.CardWidget=I,e.ControlSidebar=M,e.DirectChat=P,e.Dropdown=V,e.ExpandableTable=te,e.Fullscreen=re,e.IFrame=Qe,e.Layout=Me,e.NavbarSearch=Ct,e.PushMenu=Ke,e.SidebarSearch=ht,e.Toasts=kt,e.TodoList=Lt,e.Treeview=$t,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=adminlte.min.js.map

// toastr.options.timeOut = 3000;

function toastr_message(message, success, title = null) {
    if (typeof toastr === 'undefined') {
        console.error('Toastr is not defined. Please include it in your project.');
        return;
    }

    if (success === true) {
        toastr.success(message, title || juzaweb.lang.successfully, {timeOut: 3000});
    } else {
        toastr.error(message, title || juzaweb.lang.error, {timeOut: 3000});
    }
}

function confirm_message(question, callback, title = '', type = 'warning') {
    if (typeof Swal === 'undefined') {
        console.error('SweetAlert2 is not defined. Please include it in your project.');
        return;
    }

    Swal.fire({
        title: title,
        text: question,
        type: type,
        position: 'top',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: juzaweb.lang.yes + '!',
        cancelButtonText: juzaweb.lang.cancel + '!',
    }).then((result) => {
        callback(result.value);
    });
}

function get_message_response(response) {
    if (response.success === true) {
        if (! response.message) {
            return null;
        }

        return {
            success: true,
            message: response.message
        };
    }

    // Get message validate
    if (response.responseJSON) {
        if (response.responseJSON.errors) {
            let message = '';
            $.each(response.responseJSON.errors, function (index, msg) {
                message = msg[0];
                return false;
            });

            return {
                success: false,
                message: message
            };
        }

        else if (response.responseJSON.message) {
            return {
                success: false,
                message: response.responseJSON.message
            };
        }
    }

    // Get message errors
    if (response.message) {
        return {
            success: false,
            message: response.message,
        };
    }

    return null;
}

function show_message(response, append = false, elResult = null) {
    let msg = get_message_response(response);

    if (! msg || response.redirect) {
        return;
    }

    let msgHTML = `<div class="text-${msg.success ? 'success' : 'danger'} jw-message">
        ${msg.message}
    </div>`;

    if (append) {
        $(elResult ?? '#jquery-message').append(msgHTML);
    } else {
        $(elResult ?? '#jquery-message').html(msgHTML);
    }

    if (!$(elResult ?? '#jquery-message').is(':visible')) {
        $(elResult ?? '#jquery-message').show();
    }

    $('html, body').animate({
        scrollTop: ($(elResult ?? '#jquery-message').offset().top - 100)
    }, 500);
}

function show_notify(response) {
    let msg = get_message_response(response);
    if (! msg) {
        return;
    }
    toastr_message(msg.message, msg.success);
}

function htmlspecialchars(str) {
    str = String(str);
    return str.replace('&', '&amp;').replace('"', '&quot;').replace("'", '&#039;').replace('<', '&lt;').replace('>', '&gt;');
}

function toggle_global_loading(status, timeout = 300) {
    if (status) {
        $("#admin-overlay").fadeIn(300);
    } else {
        setTimeout(function () {
            $("#admin-overlay").fadeOut(300);
        }, timeout);
    }
}

function replace_template(template, data) {
    return template.replace(
        /{(\w*)}/g,
        function (m, key) {
            return data.hasOwnProperty(key) ? data[key] : "";
        }
    );
}

function process_each(elements, cb, timeout, options = {}) {
    let i = 0;
    let l = elements.length;

    (function fn() {
        let result = cb.call(elements[i++]);
        if (i < l) {
            setTimeout(fn, timeout);
        } else {
            if (options.completeCallback ?? false) {
                options.completeCallback(result);
            }
        }
    }());
}

function random_string(length) {
    let result = '';
    let characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
    let charactersLength = characters.length;
    for (let i = 0; i < length; i++) {
        result += characters.charAt(Math.floor(Math.random() * charactersLength));
    }
    return result;
}

function uuidv4() {
    return "10000000-1000-4000-8000-100000000000".replace(/[018]/g, c =>
        (+c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> +c / 4).toString(16)
    );
}

function generate_slug(text) {
    const map = {
        '': 'a', '': 'a', '': 'a', '': 'a', '': 'a', '': 'a', '': 'a', '': 'a', '': 'a', '': 'a', '': 'a',
        '': 'a', '': 'a', '': 'a', '': 'a', '': 'a', '': 'a',
        '': 'e', '': 'e', '': 'e', '': 'e', '': 'e', '': 'e', '': 'e', '': 'e', '': 'e', '': 'e', '': 'e',
        '': 'i', '': 'i', '': 'i', '': 'i', '': 'i',
        '': 'o', '': 'o', '': 'o', '': 'o', '': 'o', '': 'o', '': 'o', '': 'o', '': 'o', '': 'o', '': 'o',
        '': 'o', '': 'o', '': 'o', '': 'o', '': 'o', '': 'o',
        '': 'u', '': 'u', '': 'u', '': 'u', '': 'u', '': 'u', '': 'u', '': 'u', '': 'u', '': 'u', '': 'u',
        '': 'y', '': 'y', '': 'y', '': 'y', '': 'y',
        '': 'd',
        '': 'A', '': 'A', '': 'A', '': 'A', '': 'A', '': 'A', '': 'A', '': 'A', '': 'A', '': 'A', '': 'A',
        '': 'A', '': 'A', '': 'A', '': 'A', '': 'A', '': 'A',
        '': 'E', '': 'E', '': 'E', '': 'E', '': 'E', '': 'E', '': 'E', '': 'E', '': 'E', '': 'E', '': 'E',
        '': 'I', '': 'I', '': 'I', '': 'I', '': 'I',
        '': 'O', '': 'O', '': 'O', '': 'O', '': 'O', '': 'O', '': 'O', '': 'O', '': 'O', '': 'O', '': 'O',
        '': 'O', '': 'O', '': 'O', '': 'O', '': 'O', '': 'O',
        '': 'U', '': 'U', '': 'U', '': 'U', '': 'U', '': 'U', '': 'U', '': 'U', '': 'U', '': 'U', '': 'U',
        '': 'Y', '': 'Y', '': 'Y', '': 'Y', '': 'Y',
        '': 'D'
    };

    return text
        .split('')
        .map(char => map[char] || char)
        .join('')
        .toLowerCase()
        .trim()
        .replace(/[^a-z0-9\s-]/g, '')
        .replace(/\s+/g, '-')
        .replace(/-+/g, '-')
        .replace(/^-+|-+$/g, '');
}

/**
 * Open a share popup window centered on the screen
 * @param {string} url - The URL to open
 * @param {number} width - Window width
 * @param {number} height - Window height
 * @returns {boolean} false to prevent default link behavior
 */
function open_share_popup(url, width, height) {
    const left = (screen.width / 2) - (width / 2);
    const top = (screen.height / 2) - (height / 2);
    window.open(url, 'share-popup', 'width=' + width + ',height=' + height + ',left=' + left + ',top=' + top + ',scrollbars,resizable');
    return false;
}

function initSelect2(parent = 'body') {
    $(parent + ' .select2').each(function () {
        $(this).select2({
            theme: 'bootstrap4',
            width: $(this).data('width') || '100%',
            dropdownAutoWidth: !$(this).data('width'),
        });
    });
}

function initDatepicker(parent = 'body') {
    $(parent + ' .jw-datepicker').each(function () {
        const options = {
            dateFormat: 'yy-mm-dd',
            changeMonth: true,
            changeYear: true,
        };

        if ($(this).data('min-date')) {
            options.minDate = $(this).data('min-date');
        }

        if ($(this).data('max-date')) {
            options.maxDate = $(this).data('max-date');
        }

        if ($(this).data('date-format')) {
            options.dateFormat = $(this).data('date-format');
        }

        $(this).datepicker(options);
    });
}

function initEditor(parnet = 'body') {
    tinymce.init({
        selector: parnet + ' .jw-editor',
        convert_urls: true,
        document_base_url: juzaweb.documentBaseUrl,
        language: juzaweb.locale !== 'en' ? juzaweb.locale : undefined,
        language_url: juzaweb.locale !== 'en' ? '/plugins/tinymce/langs/' + juzaweb.locale + '.js' : undefined,
        urlconverter_callback: function (url, node, on_save, name) {
            return url.replace(juzaweb.documentBaseUrl, '');
        },
        height: 400,
        plugins: [
            "advlist autolink lists link image charmap print preview hr anchor pagebreak",
            "searchreplace wordcount visualblocks visualchars code fullscreen",
            "insertdatetime media nonbreaking save table directionality",
            "emoticons template paste textpattern"
        ],
        menu: {
            file: { title: 'File', items: 'newdocument restoredraft | preview | print ' },
            edit: { title: 'Edit', items: 'undo redo | cut copy paste | selectall | searchreplace' },
            view: { title: 'View', items: 'code | visualaid visualchars visualblocks | spellchecker | preview fullscreen' },
            insert: { title: 'Insert', items: 'image link media template codesample inserttable | charmap emoticons hr | pagebreak nonbreaking anchor toc | insertdatetime' },
            format: { title: 'Format', items: 'bold italic underline strikethrough superscript subscript codeformat | formats blockformats fontformats fontsizes align lineheight | forecolor backcolor | removeformat' },
            tools: { title: 'Tools', items: 'spellchecker spellcheckerlanguage | code wordcount' },
            table: { title: 'Table', items: 'inserttable | cell row column | tableprops deletetable' },
        },
        toolbar: [
            {
                name: 'new', items: ['newdocument']
            },
            {
                name: 'history', items: ['undo', 'redo']
            },
            {
                name: 'styles', items: ['styleselect']
            },
            {
                name: 'formatting', items: ['bold', 'italic']
            },
            {
                name: 'alignment', items: ['alignleft', 'aligncenter', 'alignright', 'alignjustify']
            },
            {
                name: 'indentation', items: ['outdent', 'indent']
            },
            {
                name: 'media', items: ['link', 'image', 'media']
            },
            {
                name: 'view', items: ['code', 'preview', 'fullscreen']
            }
        ],
        file_picker_callback: function (callback, value, meta) {
            // Store callback for later use
            window.tinyMceCallback = callback;

            // Determine type
            let type = meta.filetype === 'image' ? 'image' : 'file';

            // Get modal instance
            let modal = $('#jw-media-modal');
            if (modal.length === 0) {
                console.error('Media modal not found');
                return;
            }

            // Set up modal for TinyMCE mode
            modal.data('tinymce-mode', true);
            modal.data('tinymce-type', type);

            // Trigger modal open via a temporary element
            let tempButton = $('<button class="tinymce-media-picker" data-type="' + type + '" style="display:none;"></button>');
            $('body').append(tempButton);
            tempButton.click();
            tempButton.remove();
        }
    });
}

/**
 * Quick Add Category functionality
 * Provides reusable category quick-add functionality for any form
 */

function initQuickAddCategory(container = 'body') {
    const INDENT_PX = 20;
    const CHILD_PREFIX = '-- ';

    $(container).find('.quick-add-category-container').each(function () {
        const $container = $(this);
        const $form = $container.find('.quick-add-category-form');
        const $toggle = $container.find('.quick-add-category-toggle');
        const $saveBtn = $container.find('.quick-add-category-save');
        const $cancelBtn = $container.find('.quick-add-category-cancel');
        const $nameInput = $container.find('.quick-add-category-name');
        const $parentSelect = $container.find('.quick-add-category-parent');
        const $checkboxList = $container.find('.categories-checkbox-list');

        // Get configuration from data attributes
        const storeUrl = $container.data('store-url');
        const locale = $container.data('locale') || 'en';

        // Toggle form visibility
        $toggle.on('click', function () {
            $form.slideDown();
            $(this).hide();
            $nameInput.focus();
        });

        // Cancel button
        $cancelBtn.on('click', function () {
            $form.slideUp();
            $toggle.show();
            $nameInput.val('');
            $parentSelect.val('');
        });

        // Save button
        $saveBtn.on('click', function () {
            const name = $nameInput.val().trim();
            const parentId = $parentSelect.val();
            const inputName = $(this).data('input-name') || 'categories[]';

            if (!name) {
                alert($nameInput.attr('placeholder') || 'Please enter a category name');
                return;
            }

            const btn = $(this);
            const originalHtml = btn.html();
            btn.prop('disabled', true).html('<i class="fas fa-spinner fa-spin"></i> ' + (btn.data('saving-text') || 'Saving...'));

            const data = {
                locale: locale,
                parent_id: parentId || null,
                name: name,
            };

            $.ajax({
                url: storeUrl,
                method: 'POST',
                data: data,
                success: function (response) {
                    if (response.success && response.data) {
                        const newCategoryId = response.data.id;
                        const newCategoryName = response.data.name;

                        // Determine indentation level based on parent
                        let marginLeft = 0;
                        if (parentId) {
                            const parentCheckbox = $checkboxList
                                .find(`input[name="${inputName}"][value="${CSS.escape(parentId)}"]`)
                                .closest('.form-check');
                            const parentMargin = parseInt(parentCheckbox.css('margin-left')) || 0;
                            marginLeft = parentMargin + INDENT_PX;
                        }

                        // Create the new checkbox element using DOM manipulation for security
                        const newCheckboxDiv = $('<div>', {
                            'class': 'form-check',
                            'style': `margin-left: ${marginLeft}px;`
                        });

                        const newCheckbox = $('<input>', {
                            'class': 'form-check-input',
                            'type': 'checkbox',
                            'name': inputName,
                            'value': newCategoryId,
                            'id': `cat-${newCategoryId}`,
                            'checked': true
                        });

                        const newLabel = $('<label>', {
                            'class': 'form-check-label',
                            'for': `cat-${newCategoryId}`
                        }).text(newCategoryName);

                        newCheckboxDiv.append(newCheckbox).append(newLabel);

                        // Insert the new checkbox at the appropriate location
                        if (parentId) {
                            const parentCheckbox = $checkboxList.find(`input[name="${inputName}"][value="${CSS.escape(parentId)}"]`).closest('.form-check');
                            let insertAfter = parentCheckbox;

                            // Find last child of this parent using more efficient DOM traversal
                            const parentMarginLeft = parseInt(parentCheckbox.css('margin-left')) || 0;
                            const allNext = parentCheckbox.nextAll('.form-check');

                            allNext.each(function () {
                                const nextMargin = parseInt($(this).css('margin-left')) || 0;
                                if (nextMargin <= parentMarginLeft) {
                                    return false; // break
                                }
                                insertAfter = $(this);
                            });

                            insertAfter.after(newCheckboxDiv);
                        } else {
                            // Add at the end of the list if no parent
                            $checkboxList.append(newCheckboxDiv);
                        }

                        // Add new category to parent select dropdown using DOM manipulation
                        const newOption = $('<option>', {
                            'value': newCategoryId
                        }).text(parentId ? CHILD_PREFIX + newCategoryName : newCategoryName);

                        if (parentId && parentId !== '') {
                            // Find parent option safely
                            const parentOption = $parentSelect.find('option').filter(function () {
                                return $(this).val() === String(parentId);
                            });

                            // Find where to insert: after parent's last child using more efficient DOM traversal
                            let insertAfter = parentOption;
                            const allNext = parentOption.nextAll('option');

                            allNext.each(function () {
                                if ($(this).text().startsWith(CHILD_PREFIX)) {
                                    insertAfter = $(this);
                                } else {
                                    return false; // break
                                }
                            });

                            insertAfter.after(newOption);
                        } else {
                            $parentSelect.append(newOption);
                        }

                        // Reset form and hide
                        $nameInput.val('');
                        $parentSelect.val('');
                        // $form.slideUp();
                        // $toggle.show();
                        btn.prop('disabled', false).html(originalHtml);

                        // Show success message if provided
                        if (response.message) {
                            show_notify(response);
                        }
                    }
                },
                error: function (xhr) {
                    let message = 'An error occurred while creating the category';
                    if (xhr.responseJSON && xhr.responseJSON.message) {
                        message = xhr.responseJSON.message;
                    }
                    alert(message);
                    btn.prop('disabled', false).html(originalHtml);
                }
            });
        });

        // Allow Enter key to save
        $nameInput.on('keypress', function (e) {
            if (e.which === 13) {
                e.preventDefault();
                $saveBtn.click();
            }
        });
    });
}

function sendDataTablesActionRequest(endpoint, ids, action) {
    $.ajax({
        type: "POST",
        url: endpoint,
        dataType: 'json',
        data: {
            'ids': ids,
            'action': action,
        },
        beforeSend: function () {
            toggle_global_loading(true);
        },
        success: function (response) {
            if (response.window_redirect) {
                show_notify(response);
                window.location = response.window_redirect;
                return false;
            }

            if (response.redirect) {
                show_notify(response);
                setTimeout(function () {
                    window.location = response.redirect;
                }, 1000);
                return false;
            }

            toggle_global_loading(false);
            $('#select-all').prop('checked', false);
            $('.jw-datatable-bulk-actions .dropdown-toggle').prop('disabled', true);
            $('#jw-datatable').DataTable().draw();
        },
        error: function (response) {
            toggle_global_loading(false);
            show_notify(response);
        },
        complete: function () {
            toggle_global_loading(false);
        }
    });
}

let slugEditedManually = ($('#slug').length > 0) && ($('#slug').val().trim() !== '');

$(function () {
    $(document).on('click', '.jw-checkbox .custom-control-input', function () {
        $(this).closest('.jw-checkbox')
            .find('.jw-checkbox-input')
            .val($(this).is(':checked') ? '1' : '0');
    });

    $(document).on('change', '.select-language', function () {
        const locale = $(this).val();
        const currentUrl = new URL(window.location.href);
        currentUrl.searchParams.set('locale', locale);
        window.location.href = currentUrl.toString();
    });

    $(document).on('input', '.slug-target', function () {
        let value = $(this).val().trim();

        if (value === '') {
            slugEditedManually = false; // Nu user xa slug  bt auto li
        } else {
            slugEditedManually = true; // Ch lock khi thc s thay i k t
        }
    });

    $(document).on('click', '.edit-slug', function () {
        let isDisabled = $(this).closest('.input-group')
            .find('.slug-target')
            .prop('disabled');
        $(this).closest('.input-group')
            .find('.slug-target')
            .prop('disabled', !isDisabled)
            .focus();
    });

    $('.slug-source').on('keyup', function () {
        if (slugEditedManually) {
            return; // Do not overwrite manually edited slug
        }

        let text = $(this).val();

        // Convert text to slug
        let slug = text
            .toString()
            .normalize('NFD')                 // remove accents
            .replace(/[\u0300-\u036f]/g, '') // remove diacritics (Vietnamese accents)
            .toLowerCase()
            .trim()
            .replace(/[^a-z0-9\- ]/g, '')    // remove special chars
            .replace(/\s+/g, '-')            // replace spaces with -
            .replace(/\-+/g, '-');           // collapse multiple -

        $('#slug').val(slug);
    });

    $(document).on('click', '.edit-security', function () {
        let el = $(this).closest('.input-group').find('.form-control');
        let isDisabled = el.prop('disabled');
        el.prop('disabled', !isDisabled).focus();
    });

    $(document).on('click', '.add-repeater-item', function () {
        let template = $(this).closest('.repeater-component').find('script[type="text/html"]').html();
        let marker = uuidv4();

        template = template.replace(/__marker__/g, marker);
        $(this).closest('.repeater-component').find('.repeaters').append(template);
    });

    $(document).on('click', '.remove-repeater-item', function () {
        $(this).closest('.repeater-item').remove();
    });

    initSelect2('body');

    initDatepicker('body');

    initEditor('body');

    initQuickAddCategory('body');

    // Handle bulk translate action
    $(document).on('click', '.jw-datatable-bulk-action[data-action="translate"]', function (e) {
        e.preventDefault();
        e.stopPropagation();

        let endpoint = $(this).data('endpoint');
        let ids = $(".jw-datatable-checkbox:checked").map(function () {
            return $(this).val()
        }).get();

        if (ids.length === 0) {
            alert(juzaweb.lang.please_select_at_least_one_row || 'Please select at least one row');
            return false;
        }

        // Store data for the modal
        $('#translate-modal').data('ids', ids);
        $('#translate-modal').data('endpoint', endpoint);
        $('#translate-modal').modal('show');
        return false;
    });

    $(document).on('click', '#translate-submit', function () {
        let modal = $('#translate-modal');
        let model = $(this).data('model');
        let sourceLocale = $('#translate-source-locale').val();
        let targetLocale = $('#translate-target-locale').val();
        let ids = modal.data('ids');

        $.ajax({
            type: "POST",
            url: juzaweb.adminUrl + '/translations/translate-model',
            dataType: 'json',
            data: {
                'ids': ids,
                'source': sourceLocale,
                'locale': targetLocale,
                'model': model,
            },
            beforeSend: function () {
                toggle_global_loading(true);
            },
            success: function (response) {
                toggle_global_loading(false);

                if (response.history_ids && response.history_ids.length > 0) {
                    // Close translate modal
                    modal.modal('hide');

                    // Show progress modal
                    let progressModal = $('#translate-progress-modal');
                    progressModal.modal('show');

                    // Reset progress
                    $('#translate-progress-bar')
                        .css('width', '0%')
                        .attr('aria-valuenow', 0)
                        .text('0%')
                        .removeClass('bg-success bg-danger')
                        .addClass('progress-bar-animated progress-bar-striped bg-primary');
                    $('#translate-progress-status').text(juzaweb.lang.translation_processing || 'Processing...');
                    $('#translate-progress-detail').text('');

                    // Start polling
                    let historyIds = response.history_ids;
                    let pollInterval = setInterval(function () {
                        $.ajax({
                            url: juzaweb.adminUrl + '/translations/translate-status',
                            type: 'POST',
                            data: {
                                history_ids: historyIds
                            },
                            success: function (statusData) {
                                let completedCount = statusData.success + statusData.failed;
                                let progress = Math.round((completedCount / statusData.total) * 100);
                                $('#translate-progress-bar')
                                    .css('width', progress + '%')
                                    .attr('aria-valuenow', progress)
                                    .text(progress + '%');

                                let detail = juzaweb.lang.translating_items || 'Translating :current of :total items...';
                                detail = detail.replace(':current', completedCount).replace(':total', statusData.total);
                                $('#translate-progress-detail').text(detail);

                                if (statusData.completed) {
                                    clearInterval(pollInterval);

                                    if (statusData.failed > 0) {
                                        $('#translate-progress-status').text(juzaweb.lang.translation_failed || 'Translation failed');
                                        $('#translate-progress-bar').removeClass('progress-bar-animated progress-bar-striped bg-primary').addClass('bg-danger');
                                    } else {
                                        $('#translate-progress-status').text(juzaweb.lang.translation_completed || 'Translation completed');
                                        $('#translate-progress-bar').removeClass('progress-bar-animated progress-bar-striped bg-primary').addClass('bg-success');
                                    }

                                    setTimeout(function () {
                                        progressModal.modal('hide');
                                        show_notify(response);
                                        $('#select-all').prop('checked', false);
                                        $('.jw-datatable-bulk-actions .dropdown-toggle').prop('disabled', true);
                                        $('#jw-datatable').DataTable().draw();
                                    }, 2000);
                                }
                            },
                            error: function () {
                                clearInterval(pollInterval);
                                progressModal.modal('hide');
                                show_notify({ status: 'error', message: 'Error checking translation status' });
                            }
                        });
                    }, 2000); // Poll every 2 seconds
                } else {
                    // Fallback if no history IDs
                    show_notify(response);
                    modal.modal('hide');
                    $('#select-all').prop('checked', false);
                    $('.jw-datatable-bulk-actions .dropdown-toggle').prop('disabled', true);
                    $('#jw-datatable').DataTable().draw();
                }
            },
            error: function (response) {
                toggle_global_loading(false);
                show_notify(response);
            },
            complete: function () {
                toggle_global_loading(false);
            }
        });
    });

    $(document).on('click', '.translate-model', function (e) {
        e.preventDefault();
        var $this = $(this);
        var id = $this.data('id');
        var model = $this.data('model');
        var locale = $this.data('locale');
        var source = $this.data('source');

        if (id && model && locale) {
            $.ajax({
                url: juzaweb.adminUrl + '/translations/translate-model',
                type: 'POST',
                data: {
                    ids: id,
                    model: model,
                    locale: locale,
                    source: source,
                },
                beforeSend: function () {
                    toggle_global_loading(true);
                },
                success: function (response) {
                    toggle_global_loading(false);

                    if (response.history_ids && response.history_ids.length > 0) {
                        // Show progress modal
                        let progressModal = $('#translate-progress-modal');
                        progressModal.modal('show');

                        // Reset progress
                        $('#translate-progress-bar')
                            .css('width', '0%')
                            .attr('aria-valuenow', 0)
                            .text('0%')
                            .removeClass('bg-success bg-danger')
                            .addClass('progress-bar-animated progress-bar-striped bg-primary');
                        $('#translate-progress-status').text(juzaweb.lang.translation_processing || 'Processing...');
                        $('#translate-progress-detail').text('');

                        // Start polling
                        let historyIds = response.history_ids;
                        let pollInterval = setInterval(function () {
                            $.ajax({
                                url: juzaweb.adminUrl + '/translations/translate-status',
                                type: 'POST',
                                data: {
                                    history_ids: historyIds
                                },
                                success: function (statusData) {
                                    let completedCount = statusData.success + statusData.failed;
                                    let progress = Math.round((completedCount / statusData.total) * 100);
                                    $('#translate-progress-bar')
                                        .css('width', progress + '%')
                                        .attr('aria-valuenow', progress)
                                        .text(progress + '%');

                                    let detail = juzaweb.lang.translating_items || 'Translating :current of :total items...';
                                    detail = detail.replace(':current', completedCount).replace(':total', statusData.total);
                                    $('#translate-progress-detail').text(detail);

                                    if (statusData.completed) {
                                        clearInterval(pollInterval);

                                        if (statusData.failed > 0) {
                                            $('#translate-progress-status').text(juzaweb.lang.translation_failed || 'Translation failed');
                                            $('#translate-progress-bar').removeClass('progress-bar-animated progress-bar-striped bg-primary').addClass('bg-danger');
                                        } else {
                                            $('#translate-progress-status').text(juzaweb.lang.translation_completed || 'Translation completed');
                                            $('#translate-progress-bar').removeClass('progress-bar-animated progress-bar-striped bg-primary').addClass('bg-success');
                                        }

                                        setTimeout(function () {
                                            progressModal.modal('hide');
                                            show_notify(response);
                                            window.location.reload();
                                        }, 2000);
                                    }
                                },
                                error: function () {
                                    clearInterval(pollInterval);
                                    progressModal.modal('hide');
                                    show_notify({ status: 'error', message: 'Error checking translation status' });
                                }
                            });
                        }, 2000); // Poll every 2 seconds
                    } else {
                        show_notify(response);
                    }
                },
                error: function (xhr) {
                    toggle_global_loading(false);
                    show_notify(xhr);
                }
            });
        }
    });

    initCurrencyInput('body');
});

function initCurrencyInput(parent = 'body') {
    $(parent + ' .currency-input').each(function () {
        const $input = $(this);
        const decimals = parseInt($input.data('decimals')) || 2;
        const thousandSep = $input.data('thousand-separator') || ',';
        const decimalSep = $input.data('decimal-separator') || '.';

        // Format on blur
        $input.on('blur', function () {
            let value = $(this).val().replace(/[^\d.-]/g, '');

            if (value === '' || value === '-') {
                return;
            }

            let num = parseFloat(value);
            if (!isNaN(num)) {
                $(this).val(formatCurrency(num, decimals, decimalSep, thousandSep));
            }
        });

        // Remove formatting on focus
        $input.on('focus', function () {
            let value = $(this).val();
            if (value) {
                // Remove all separators to get raw number
                value = value.replace(new RegExp('\\' + thousandSep, 'g'), '');
                value = value.replace(new RegExp('\\' + decimalSep, 'g'), '.');
                $(this).val(value);
            }
        });

        // Format initial value
        if ($input.val()) {
            let value = $input.val().replace(/[^\d.-]/g, '');
            let num = parseFloat(value);
            if (!isNaN(num)) {
                $input.val(formatCurrency(num, decimals, decimalSep, thousandSep));
            }
        }
    });
}

function formatCurrency(num, decimals, decimalSep, thousandSep) {
    const fixed = num.toFixed(decimals);
    const parts = fixed.split('.');

    // Add thousand separators
    parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, thousandSep);

    return parts.join(decimalSep);
}


let searchTimeout;

$(function () {
    $(document).on('click', '#select-all', function () {
        const rows = $('#jw-datatable').DataTable().rows({ 'search': 'applied' }).nodes();
        const checked = this.checked;

        $('input[type="checkbox"]', rows).prop('checked', checked);
        $('.jw-datatable-bulk-actions .dropdown-toggle').prop('disabled', !checked);
    });

    $(document).on('change', '.jw-datatable-checkbox', function () {
        const checked = $('.jw-datatable-checkbox:checked').length > 0;

        $('.jw-datatable-bulk-actions .dropdown-toggle').prop('disabled', !checked);
    });

    $(document).on('input', '.jw-datatable_filter input[type="search"]', function () {
        clearTimeout(searchTimeout);

        const value = this.value;

        searchTimeout = setTimeout(function () {
            const dt = $('#jw-datatable').DataTable();
            dt.search(value).draw();
        }, 300);
    });

    $(document).on('click', '#jw-datatable .datatables-row-action[data-type="action"]', function () {
        let ids = [$(this).data('id')];
        let action = $(this).data('action');
        let endpoint = $(this).data('endpoint');

        if (action == 'delete') {
            confirm_message(juzaweb.lang.remove_question, function (result) {
                if (result) {
                    sendDataTablesActionRequest(endpoint, ids, action);
                }
            })
        } else {
            sendDataTablesActionRequest(endpoint, ids, action);
        }

        return false;
    });

    $(document).on('click', '.jw-datatable-bulk-action[data-type="action"]', function () {
        let action = $(this).data('action');
        let endpoint = $(this).data('endpoint');
        let ids = $(".jw-datatable-checkbox:checked").map(function(){return $(this).val()}).get();

        if (action == 'delete') {
            confirm_message(
                juzaweb.lang.remove_question,
                function (result) {
                    if (result) {
                        sendDataTablesActionRequest(endpoint, ids, action);
                    }
                }
            );
        } else {
            sendDataTablesActionRequest(endpoint, ids, action);
        }
    });

    $(document).on('change', '.jw-datatable_filters input, .jw-datatable_filters select', function () {
        const paramKey = $(this).attr('name');
        const paramValue = $(this).val();

        // Parse current URL
        let url = new URL(window.location.href);
        let params = new URLSearchParams(url.search);

        // Set or update the parameter
        params.set(paramKey, paramValue);

        // Construct the new URL
        url.search = params.toString();
        let newurl = url.toString();

        // Push new state to browser history
        window.history.pushState({ path: newurl }, '', newurl);

        // Update the datatable source and reload
        $('#jw-datatable').DataTable()
            .ajax
            .url(newurl);

        $('#jw-datatable').DataTable().ajax.reload();
    });
});
let juzawebFileManager = function (options, cb) {
    let type = options.type || 'image';
    let disk = options.disk || null;
    let routePrefix = options.prefix;
    let multichoose = options.multichoose || false;

    if (routePrefix[0] !== '/') {
        routePrefix = '/' + routePrefix;
    }

    let dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : window.screenX;
    let w = options.width ? options.width : 800;
    let h = options.height ? options.height : 500;
    let dualScreenTop = window.screenTop !== undefined ? window.screenTop : window.screenY;
    let width = window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : screen.width;
    let height = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : screen.height;
    let systemZoom = width / window.screen.availWidth;
    let left = (width - w) / 2 / systemZoom + dualScreenLeft;
    let top = (height - h) / 2 / systemZoom + dualScreenTop;

    window.open(routePrefix + '?type=' + type + (multichoose ? '&multichoose=1' : '') + (disk ? '&disk=' + disk : ''), 'File Manager', 'scrollbars=yes, width=' + w / systemZoom + ', height=' + h / systemZoom + ', top=' + top + ', left=' + left);
    window.SetUrl = cb;
};

$.fn.filemanager = function(type, options) {
    let element = this;
    let prefix = '/admin/'+ juzaweb.websiteId +'/file-manager/public/browser';
    this.on('click', function(e) {
        juzawebFileManager({
            type: type,
            prefix: prefix
        }, function (files) {
            let file = files[0];

            if (element.data('input')) {
                let targetInput = $('#' + element.data('input'));
                targetInput.val(file.path);
            }

            if (element.data('preview')) {
                let targetPreview = $('#' + element.data('preview'));
                targetPreview.html('<img src="'+ file.url +'" alt="'+ file.name +'">');
            }

            if (element.data('name')) {
                let targetName = $('#' + element.data('name'));
                targetName.html(file.name);
            }
        });
    });
};

$(function () {
    const bodyElement = $('body');

    bodyElement.on('click', '.file-manager', function () {
        let type = $(this).data('type') || 'image';
        let input = $(this).data('input');
        let preview = $(this).data('preview');
        let name = $(this).data('name');
        let disk = $(this).data('disk') || 'public';
        let prefix = `/admin/${juzaweb.websiteId}/file-manager/${disk}/browser`;

        juzawebFileManager({
            type: type,
            prefix: prefix,
            disk: disk
        }, function (files) {
            let file = files[0];

            if (input) {
                let targetInput = $('#' + input);
                targetInput.val(file.path);
            }

            if (preview) {
                let targetPreview = $('#' + preview);
                targetPreview.html('<img src="'+ file.url +'" alt="">');
            }

            if (name) {
                let targetName = $('#' + name);
                targetName.html(file.name);
            }
        });
    });

    bodyElement.on('click', '.form-image', function () {
        let item = $(this);
        let targetInput = item.find('.input-path');
        let targetPreview = item.find('.dropify-render');
        let targetName = item.find('.dropify-filename-inner');
        let prefix = '/admin/'+ juzaweb.websiteId +'/file-manager/public/browser';

        juzawebFileManager({
            type: 'image',
            prefix: prefix
        }, function (files) {
            let file = files[0];
            targetInput.val(file.path);
            targetPreview.html('<img src="'+ file.url +'" alt="">');
            targetName.html(file.name);
            item.addClass('previewing');
            item.find('.image-hidden').show();
        });
    });

    bodyElement.on('click', '.form-image .image-clear', function (e) {
        e.stopPropagation();
        let item = $(this).closest('.form-image');
        let targetInput = item.find('.input-path');
        let targetPreview = item.find('.dropify-render');
        let targetName = item.find('.dropify-filename-inner');
        targetInput.val("");
        targetPreview.html('');
        targetName.html("");
        item.removeClass('previewing');
        item.find('.image-hidden').hide();
    });

    bodyElement.on('click', '.add-image-images', function () {
        let prefix = '/admin/'+ juzaweb.websiteId +'/file-manager/public/browser';
        let item = $(this).closest('.form-images');
        let inputName = item.find('.input-name').val();

        juzawebFileManager({
            type: 'image',
            prefix: prefix,
            multichoose: true
        }, function (files) {
            let temp = document.getElementById('form-images-template').innerHTML;
            let str = "";

            $.each(files, function (index, file) {
                str += replace_template(temp, {
                    name: inputName,
                    url: file.url,
                    path: file.path,
                });
            });

            item.find('.images-list .image-item:last').before(str);
        });
    });

    bodyElement.on('click', '.form-images .remove-image-item', function () {
        $(this).closest('.image-item').remove();
    });
});

/*
 * JUZAWEB CMS 1.0 - Form Ajax support
 *
 *
 * Copyright JS Foundation and other contributors
 * Released under the MIT license
 *
 * Date: 2021-03-12T21:04Z
 */

$(function () {
    $.ajaxSetup({
        headers: {
            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        },
    });

    $(document).ajaxError(function (event, jqxhr, settings, thrownError) {
        if (jqxhr.status === 401) {
            alert('Your session has expired. Please login again.');
            window.location.reload();
        }

        if (jqxhr.status === 419) {
            alert('Your session has expired. Please login again.');
            window.location.reload();
        }
    });

    function sendMessageByResponse(response, notify = true, elResult = null) {
        if (notify) {
            if (typeof show_notify !== 'undefined' && typeof show_notify === 'function') {
                show_notify(response);
            }
        } else {
            if (typeof show_message !== 'undefined' && typeof show_message === 'function') {
                show_message(response, false, elResult);
            }
        }
    }

    function sendRequestFormAjax(form, data, btnsubmit, currentText, currentIcon, captchaToken = null, jwToken) {
        let submitSuccess = form.data('success');
        let notify = form.data('notify') ?? true;
        let elResult = form.find('.jquery-message') ?? null;

        if (captchaToken) {
            data.append('g-recaptcha-response', captchaToken);
        }

        if (jwToken) {
            data.append('jw-token', jwToken);
        }

        $.ajax({
            type: form.attr('method'),
            url: form.attr('action'),
            dataType: 'json',
            data: data,
            cache: false,
            contentType: false,
            processData: false,
            success: function (response) {
                sendMessageByResponse(response, notify, elResult);

                if (response.redirect || response.redirect_url) {
                    setTimeout(function () {
                        window.location = response.redirect || response.redirect_url;
                    }, 1000);
                    return false;
                }

                btnsubmit.find('i').attr('class', currentIcon);
                btnsubmit.prop("disabled", false);

                if (btnsubmit.data('loading-text')) {
                    btnsubmit.html(currentText);
                }

                if (response.success === false) {
                    return false;
                }

                if (submitSuccess) {
                    eval(submitSuccess)(form, response);
                }
            },
            error: function (jqxhr, textStatus, errorThrown) {
                let response = jqxhr.responseJSON;

                if (jqxhr.status === 422) {
                    let hasShowInput = 0;
                    if (typeof response.errors !== 'undefined') {
                        $.each(response.errors, function (key, value) {
                            if (form.find('.error-' + key).length) {
                                form.find('.error-' + key).html(value[0]);
                                hasShowInput += 1;
                            }
                        });
                    }

                    if (hasShowInput === 0) {
                        sendMessageByResponse(jqxhr, notify, elResult);
                    }
                } else {
                    sendMessageByResponse(jqxhr, notify, elResult);
                }

                btnsubmit.find('i').attr('class', currentIcon);
                btnsubmit.prop("disabled", false);

                if (btnsubmit.data('loading-text')) {
                    btnsubmit.html(currentText);
                }
            }
        });
    }

    $(document).on('submit', '.form-ajax', function (event) {
        if (event.isDefaultPrevented()) {
            return false;
        }

        event.preventDefault();

        let form = $(this);
        let formData = new FormData(form[0]);
        let btnsubmit = form.find("button[type=submit]");
        let currentText = btnsubmit.html();
        let currentIcon = btnsubmit.find('i').attr('class');
        let hasToken = form.data('jw-token') ?? false;

        btnsubmit.find('i').attr('class', 'fas fa-spinner fa-spin');
        btnsubmit.prop("disabled", true);

        if (btnsubmit.data('loading-text')) {
            btnsubmit.html('<i class="fas fa-spinner fa-spin"></i> ' + btnsubmit.data('loading-text'));
        }

        if (typeof grecaptcha !== 'undefined') {
            loadRecapchaAndSubmit(
                function (token) {
                    if (hasToken) {
                        loadReCaptcha().then(function (jwToken) {
                            sendRequestFormAjax(
                                form,
                                formData,
                                btnsubmit,
                                currentText,
                                currentIcon,
                                token,
                                jwToken
                            );
                        });
                    } else {
                        sendRequestFormAjax(
                            form,
                            formData,
                            btnsubmit,
                            currentText,
                            currentIcon,
                            token
                        );
                    }
                }
            );
            return false;
        }

        if (hasToken) {
            loadReCaptcha().then(function (jwToken) {
                sendRequestFormAjax(
                    form,
                    formData,
                    btnsubmit,
                    currentText,
                    currentIcon,
                    null,
                    jwToken
                );
            });
        } else {
            sendRequestFormAjax(
                form,
                formData,
                btnsubmit,
                currentText,
                currentIcon
            );
        }
    });

    $(document).on('keypress', '.is-number', function () {
        return validate_isNumberKey(this);
    });

    $(document).on('keyup', '.number-format', function () {
        return validate_FormatNumber(this);
    });

    function validate_isNumberKey(evt) {
        let charCode = (evt.which) ? evt.which : event.keyCode;
        if (charCode == 59 || charCode == 46)
            return true;
        if (charCode > 31 && (charCode < 48 || charCode > 57))
            return false;
        return true;
    }

    function validate_FormatNumber(a) {
        a.value = a.value.replace(/\,/gi, "");
        a.value = a.value.replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,");
    }
});

function initSelect2(parent = 'body') {
    $(parent + ' .select2-input').select2({
        width: $(this).data('width') || '100%',
        placeholder: $(this).data('placeholder') || null,
    });

    $(parent + ' .load-data').each(function () {
        const $el = $(this);

        $el.select2({
            allowClear: true,
            dropdownAutoWidth: !$el.data('width'),
            width: $el.data('width') || '100%',
            placeholder: function (params) {
                return {
                    id: null,
                    text: params.placeholder,
                };
            },
            ajax: {
                method: 'GET',
                url: $el.data('url'),
                dataType: 'json',
                data: function (params) {
                    let explodes = $el.data('explodes') ? $el.data('explodes') : null;
                    if (explodes) {
                        explodes = $("." + explodes)
                            .map(function () {
                                return $(this).val();
                            })
                            .get();
                    }

                    return {
                        q: $.trim(params.term),
                        page: params.page,
                        explodes: explodes,
                    };
                }
            },
        });
    });

    $(parent + ' .tags-input').each(function () {
        const $el = $(this);

        $el.select2({
            theme: 'bootstrap4',
            tags: true,
            tokenSeparators: [','],
            placeholder: $el.data('placeholder'),
            ajax: {
                url: $el.data('url'),
                dataType: 'json',
                delay: 250,
                data: function (params) {
                    return {
                        q: params.term,
                        page: params.page,
                    };
                },
            },
            createTag: function (params) {
                var term = $.trim(params.term);
                if (term === '') return null;
                return {
                    id: term,
                    text: term,
                    newTag: true,
                };
            }
        });
    });
}

$(function () {
    initSelect2('body');
});

$(function () {
    const mediaContainer = $('#media-container');
    let isLoading = false;
    let currentPage = window.mediaInfiniteScroll ? window.mediaInfiniteScroll.currentPage : 1;
    let hasMorePages = window.mediaInfiniteScroll ? window.mediaInfiniteScroll.hasMorePages : true;
    let contextMenuItem = null;

    mediaContainer.on('click', '.show-form-upload', function () {
        let form = $('.media-upload-form');

        if (form.is(':hidden')) {
            form.show('slow');
        } else {
            form.hide('slow');
        }
    });

    // Context menu functionality
    mediaContainer.on('contextmenu', '.media-item', function (e) {
        e.preventDefault();
        
        contextMenuItem = $(this);
        const contextMenu = $('#context-menu');
        
        // Position the context menu
        contextMenu.css({
            display: 'block',
            left: e.pageX + 'px',
            top: e.pageY + 'px'
        });
        
        return false;
    });

    // Hide context menu when clicking elsewhere
    $(document).on('click', function (e) {
        if (!$(e.target).closest('#context-menu').length) {
            $('#context-menu').hide();
        }
    });

    // Handle context menu actions
    $('#context-menu').on('click', '.context-menu-item', function () {
        const action = $(this).data('action');
        $('#context-menu').hide();
        
        if (!contextMenuItem) return;
        
        if (action === 'view-detail') {
            const mediaLink = contextMenuItem.find('.media-item-info');
            if (mediaLink.hasClass('media-file-item')) {
                showPreviewModal(mediaLink);
            }
        } else if (action === 'delete') {
            const mediaLink = contextMenuItem.find('.media-item-info');
            const info = JSON.parse(mediaLink.find('.item-info').val());
            deleteMediaItem(info.id, info.is_file, info.name);
        }
        
        contextMenuItem = null;
    });

    function showPreviewModal(mediaLink) {
        let temp = document.getElementById('media-detail-template').innerHTML;
        let info = JSON.parse(mediaLink.find('.item-info').val());

        info.name = htmlspecialchars(info.name);
        temp = replace_template(temp, info);

        const modal = $('#media-preview-modal');
        modal.find('.modal-body').html(temp);
        modal.modal('show');
    }

    mediaContainer.on('click', '.media-file-item', function () {
        showPreviewModal($(this));
    });

    function deleteMediaItem(id, is_file, name) {
        confirm_message(
            juzaweb.lang.remove_question.replace(':name', (is_file == 1 ? ' file '+ name : ' folder '+ name)),
            function (value) {
                if (!value) {
                    return false;
                }

                toggle_global_loading(true);
                $.ajax({
                    url: juzaweb.adminUrl + '/media/'+ id,
                    type: 'DELETE',
                    data: {
                        is_file: is_file
                    },
                    success: function (response) {
                        toggle_global_loading(false);
                        show_notify(response);

                        setTimeout(
                            function () {
                                window.location.reload();
                            },
                            500
                        );
                    },
                    error: function (response) {
                        toggle_global_loading(false);
                        show_notify(response);
                    }
                });
            }
        );
    }

    $('#media-preview-modal').on('click', '.delete-file', function () {
        let id = $(this).data('id');
        let is_file = $(this).data('is_file');
        let name = $(this).data('name');
        deleteMediaItem(id, is_file, name);
    });

    // Infinite scroll functionality
    function loadMoreMedia() {
        if (isLoading || !hasMorePages) {
            return;
        }

        isLoading = true;
        $('.loading-indicator').show();

        const nextPage = currentPage + 1;
        const searchParams = new URLSearchParams(window.location.search);
        searchParams.set('page', nextPage);

        const folderId = $('#media-container').data('folder-id');
        let loadMoreUrl = juzaweb.adminUrl + '/media/load-more';
        
        if (folderId) {
            loadMoreUrl = juzaweb.adminUrl + '/media/folder/' + folderId + '/load-more';
        }

        $.ajax({
            url: loadMoreUrl + '?' + searchParams.toString(),
            type: 'GET',
            success: function (response) {
                if (response.html && response.html.trim() !== '') {
                    const mediaList = $('.media-list');
                    mediaList.append(response.html);

                    // Initialize lazyload for new images
                    if (typeof lazySizes !== 'undefined' && lazySizes.autoSizer) {
                        // Trigger lazySizes to check for new lazyload elements
                        lazySizes.autoSizer.checkElems();
                    }

                    currentPage = response.current_page;
                    hasMorePages = response.has_more;
                }

                isLoading = false;
                $('.loading-indicator').hide();
            },
            error: function (response) {
                console.error('Error loading more media:', response);
                isLoading = false;
                $('.loading-indicator').hide();
            }
        });
    }

    // Scroll event listener for infinite scroll
    $('.list-media').on('scroll', function () {
        const scrollTop = $(this).scrollTop();
        const scrollHeight = $(this)[0].scrollHeight;
        const clientHeight = $(this).height();

        // Load more when user scrolls to 80% of the container
        if (scrollTop + clientHeight >= scrollHeight * 0.8) {
            loadMoreMedia();
        }
    });
});

$(function () {
    const bodyElement = $('body');
    let currentPage = 1;
    let hasMorePages = true;
    let isLoading = false;
    let currentFolderId = null;
    let currentType = null;

    // Create Modal HTML if not exists
    if ($('#jw-media-modal').length === 0) {
        let uploadUrl = '/admin/file-manager/public/upload';
        if (typeof juzaweb !== 'undefined' && juzaweb.websiteId) {
            uploadUrl = '/admin/' + juzaweb.websiteId + '/file-manager/public/upload';
        }

        let modalHtml = `
            <div class="modal fade" id="jw-media-modal" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog modal-xl" style="max-width: 90%; height: 90%; margin: 30px auto;">
                    <div class="modal-content" style="height: 100%;">
                        <div class="modal-header" style="display: block;">
                            <div class="d-flex justify-content-between align-items-center">
                                <ul class="nav nav-tabs mb-0" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active" id="library-tab" data-toggle="tab" href="#library" role="tab">
                                            <i class="fa fa-images"></i> Media Library
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="upload-tab" data-toggle="tab" href="#upload" role="tab">
                                            <i class="fa fa-cloud-upload-alt"></i> Upload Files
                                        </a>
                                    </li>
                                </ul>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                        </div>
                        <div class="modal-body p-0" style="overflow-y: auto;">
                            <div class="tab-content h-100">
                                <div class="tab-pane fade show active h-100" id="library" role="tabpanel">
                                    <div class="media-list-container p-3 h-100" style="overflow-y: auto;">
                                        <ul class="media-list row list-unstyled"></ul>
                                        <div class="loading-indicator text-center p-3" style="display: none;">
                                            <i class="fa fa-spinner fa-spin fa-2x"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade h-100" id="upload" role="tabpanel">
                                    <div class="upload-container p-4">
                                        <form action="${uploadUrl}" id="dropzoneForm" class="dropzone">
                                            <input type="hidden" name="_token" value="${$('meta[name="csrf-token"]').attr('content')}">
                                            <input type="hidden" name="working_dir" id="upload_working_dir" value="">
                                            <div class="dz-message text-center p-5">
                                                <i class="fa fa-cloud-upload-alt fa-4x mb-3 text-muted"></i>
                                                <h4>Drop files here or click to upload</h4>
                                                <p class="text-muted">You can upload multiple files at once</p>
                                            </div>
                                        </form>
                                        <div class="upload-info mt-3 alert alert-info" style="display: none;">
                                            <i class="fa fa-info-circle"></i> <span class="upload-message"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        bodyElement.append(modalHtml);
    }

    const modal = $('#jw-media-modal');
    const mediaList = modal.find('.media-list');
    const loadingIndicator = modal.find('.loading-indicator');
    const modalBody = modal.find('.modal-body');

    let currentTarget = null;

    function loadMedia(page, folderId = null, type = null, append = true) {
        if (isLoading) return;
        isLoading = true;
        loadingIndicator.show();

        let prefix = '/admin/media/load-more';
        if (typeof juzaweb !== 'undefined' && juzaweb.websiteId) {
            prefix = '/admin/' + juzaweb.websiteId + '/media/load-more';
        }

        if (folderId) {
            prefix = '/admin/' + juzaweb.websiteId + '/media/folder/' + folderId + '/load-more';
        }

        let ajaxData = { page: page };
        if (type) {
            ajaxData.type = type;
        }

        $.ajax({
            url: prefix,
            type: 'GET',
            data: ajaxData,
            success: function (response) {
                if (append) {
                    mediaList.append(response.html);
                } else {
                    mediaList.html(response.html);
                }

                currentPage = response.current_page;
                hasMorePages = response.has_more;
                isLoading = false;
                loadingIndicator.hide();

                // Initialize lazyload if available
                if (typeof lazySizes !== 'undefined' && lazySizes.autoSizer) {
                    lazySizes.autoSizer.checkElems();
                }
                // if (typeof lazyload !== 'undefined') {
                //     lazyload();
                // }
            },
            error: function () {
                isLoading = false;
                loadingIndicator.hide();
            }
        });
    }

    bodyElement.on('click', '.form-image-modal', function () {
        currentTarget = $(this);

        // Reset state
        currentPage = 1;
        hasMorePages = true;
        currentFolderId = null;
        currentType = $(this).data('type') || null;
        mediaList.empty();

        loadMedia(currentPage, currentFolderId, currentType);
        modal.modal('show');
    });

    // Handler for upload-url field media picker
    bodyElement.on('click', '.upload-url-media-picker', function () {
        let inputId = $(this).data('input');
        let inputField = $('#' + inputId);

        if (inputField.length === 0) return;

        // Store reference to input field
        currentTarget = inputField;

        // Reset state
        currentPage = 1;
        hasMorePages = true;
        currentFolderId = null;
        currentType = $(this).data('type') || null;
        mediaList.empty();

        loadMedia(currentPage, currentFolderId, currentType);
        modal.modal('show');
    });

    // Handler for TinyMCE file picker
    bodyElement.on('click', '.tinymce-media-picker', function () {
        // Reset state
        currentPage = 1;
        hasMorePages = true;
        currentFolderId = null;
        currentType = $(this).data('type') || null;
        mediaList.empty();

        // Set TinyMCE mode flag
        modal.data('tinymce-mode', true);

        loadMedia(currentPage, currentFolderId, currentType);
        modal.modal('show');
    });

    // Handler for images field (multiple selection)
    let selectedImages = [];
    let imagesContainer = null;

    bodyElement.on('click', '.add-image-images-modal', function () {
        imagesContainer = $(this).closest('.form-images');
        selectedImages = [];

        // Reset state
        currentPage = 1;
        hasMorePages = true;
        currentFolderId = null;
        currentType = $(this).data('type') || 'image';
        mediaList.empty();

        // Set modal to multiple selection mode
        modal.data('multiple-mode', true);
        modal.find('#library .media-list-container').prepend('<div class="text-right mb-2"><button type="button" class="btn btn-success btn-confirm-selection" style="display:none;"><i class="fa fa-check"></i> Add Selected</button></div>');

        loadMedia(currentPage, currentFolderId, currentType);
        modal.modal('show');
    });

    // Toggle image selection in multiple mode
    modal.on('click', '.media-file-item', function (e) {
        if (!modal.data('multiple-mode')) {
            return; // Let default handler work for single selection
        }

        e.preventDefault();
        e.stopPropagation();

        let item = $(this);
        let infoText = item.find('.item-info').val();
        let file = JSON.parse(infoText);

        // Toggle selection
        if (item.hasClass('selected')) {
            item.removeClass('selected');
            item.find('.selection-checkmark').remove();
            selectedImages = selectedImages.filter(f => f.path !== file.path);
        } else {
            item.addClass('selected');
            item.find('.attachment-preview').append('<div class="selection-checkmark"><i class="fa fa-check-circle"></i></div>');
            selectedImages.push(file);
        }

        // Show/hide confirm button
        if (selectedImages.length > 0) {
            modal.find('.btn-confirm-selection').show();
        } else {
            modal.find('.btn-confirm-selection').hide();
        }
    });

    // Confirm multiple selection
    modal.on('click', '.btn-confirm-selection', function () {
        if (!imagesContainer || selectedImages.length === 0) return;

        let inputName = imagesContainer.find('.input-name').val();
        let temp = document.getElementById('form-images-template').innerHTML;
        let str = "";

        $.each(selectedImages, function (index, file) {
            str += replace_template(temp, {
                name: inputName,
                url: file.url,
                path: file.path,
            });
        });

        imagesContainer.find('.images-list .image-item:last').before(str);
        modal.modal('hide');
    });

    // Reset multiple mode when modal closes
    modal.on('hidden.bs.modal', function () {
        modal.data('multiple-mode', false);
        modal.data('tinymce-mode', false);
        modal.find('.btn-confirm-selection').remove();
        modal.find('.media-file-item').removeClass('selected');
        modal.find('.selection-checkmark').remove();
        selectedImages = [];
        imagesContainer = null;
    });

    // Infinite scroll
    modalBody.on('scroll', function () {
        if ($(this).scrollTop() + $(this).innerHeight() >= $(this)[0].scrollHeight - 100) {
            if (hasMorePages && !isLoading) {
                loadMedia(currentPage + 1, currentFolderId, currentType);
            }
        }
    });

    // Handle item selection (files) - single selection mode
    modal.on('click', '.media-file-item', function (e) {
        // Skip if in multiple mode - let multiple handler work
        if (modal.data('multiple-mode')) {
            return;
        }

        e.preventDefault();

        let infoText = $(this).find('.item-info').val();
        let file = JSON.parse(infoText);

        // Check if in TinyMCE mode
        if (modal.data('tinymce-mode')) {
            if (window.tinyMceCallback) {
                window.tinyMceCallback(file.url);
                window.tinyMceCallback = null;
            }
            modal.modal('hide');
            return;
        }

        if (!currentTarget) return;

        // Check if currentTarget is an input field (upload-url) or form-image-modal
        if (currentTarget.is('input')) {
            // For upload-url field: just set the URL
            currentTarget.val(file.path);
        } else {
            // For form-image-modal: set image preview
            let targetInput = currentTarget.find('.input-path');
            let targetPreview = currentTarget.find('.dropify-render');
            let targetName = currentTarget.find('.dropify-filename-inner');

            targetInput.val(file.path);
            targetPreview.html('<img src="' + file.url + '" alt="">');
            targetName.html(file.name);

            currentTarget.addClass('previewing');
            currentTarget.find('.image-hidden').show();
        }

        modal.modal('hide');
    });

    // Handle folder navigation
    modal.on('click', '.media-item a:not(.media-file-item)', function (e) {
        e.preventDefault();
        let id = $(this).data('id');
        if (id) {
            currentFolderId = id;
            currentPage = 1;
            hasMorePages = true;
            loadMedia(currentPage, currentFolderId, currentType, false);
        }
    });

    bodyElement.on('click', '.form-image-modal .image-clear', function (e) {
        e.stopPropagation();
        let item = $(this).closest('.form-image-modal');
        let targetInput = item.find('.input-path');
        let targetPreview = item.find('.dropify-render');
        let targetName = item.find('.dropify-filename-inner');
        targetInput.val("");
        targetPreview.html('');
        targetName.html("");
        item.removeClass('previewing');
        item.find('.image-hidden').hide();
    });

    // Dropzone instance
    let dropzoneInstance = null;

    // Initialize Dropzone when Upload tab is clicked
    modal.on('shown.bs.tab', '#upload-tab', function (e) {
        if (dropzoneInstance) return; // Already initialized

        Dropzone.autoDiscover = false;

        let acceptedFiles = null;
        if (currentType) {
            // Get mime types from config based on type
            let mimeTypes = {
                'image': 'image/*',
                'video': 'video/*',
                'audio': 'audio/*',
                'document': '.pdf,.doc,.docx,.txt',
                'file': '*'
            };
            acceptedFiles = mimeTypes[currentType] || null;
        }

        dropzoneInstance = new Dropzone("#dropzoneForm", {
            paramName: "upload",
            uploadMultiple: false,
            parallelUploads: 5,
            timeout: 0,
            acceptedFiles: acceptedFiles,
            maxFilesize: 15, // MB
            chunking: true,
            forceChunking: true,
            chunkSize: 1048576, // 1MB chunks
            headers: {
                'Authorization': "Bearer " + $('meta[name="csrf-token"]').attr('content')
            },
            init: function () {
                this.on('success', function (file, response) {
                    // Show success message
                    modal.find('.upload-info').show().removeClass('alert-danger').addClass('alert-success');
                    modal.find('.upload-message').text('File uploaded successfully!');

                    // Remove file from dropzone
                    this.removeFile(file);

                    // Reload media list
                    currentPage = 1;
                    hasMorePages = true;
                    mediaList.empty();
                    loadMedia(currentPage, currentFolderId, currentType, false);

                    // Switch back to Library tab after short delay
                    setTimeout(function () {
                        $('#library-tab').tab('show');
                        modal.find('.upload-info').hide();
                    }, 1500);
                });

                this.on('error', function (file, errorMessage) {
                    modal.find('.upload-info').show().removeClass('alert-success').addClass('alert-danger');
                    modal.find('.upload-message').text('Upload failed: ' + (errorMessage.message || errorMessage));
                    this.removeFile(file);
                });

                this.on('sending', function (file, xhr, formData) {
                    formData.append('working_dir', currentFolderId || '');
                });
            }
        });
    });

    // Update working_dir when opening modal
    bodyElement.on('show.bs.modal', '#jw-media-modal', function () {
        $('#upload_working_dir').val(currentFolderId || '');
    });
});

$(function () {
    var updateOutput = function (e) {
        var list = e.length ? e : $(e.target);

        if (window.JSON) {
            $('#items-output').val(window.JSON.stringify(list.nestable('serialize')));
        } else {
            alert('JSON browser support required for this application.');
        }
    };

    $('#jw-menu-builder').nestable({
        noDragClass: 'dd-nodrag',

    }).on('change', updateOutput);

    updateOutput($('#jw-menu-builder'));

    $('#menu-container').on('submit', '.form-menu-block', function (event) {
        if (event.isDefaultPrevented()) {
            return false;
        }

        event.preventDefault();
        const form = $(this);
        const formData = new FormData(form[0]);
        const formKey = form.data('key');

        let tempData = {};
        let attributes = 'data-target="_self"';
        for (const [key, value] of formData.entries()) {
            tempData[key] = value;
            attributes += ` data-${key}="${htmlspecialchars(value)}"`;
        }

        let template = form.data('template');
        let menuItemTemplate = document.getElementById('template-menu-item').innerHTML;
        let templateHtml = document.getElementById('template-menu-item-' + template).innerHTML;

        if (template === 'custom') {
            templateHtml = replace_template(templateHtml, tempData);
            menuItemTemplate = replace_template(
                menuItemTemplate,
                {
                    slot: templateHtml,
                    label: htmlspecialchars(tempData.label),
                    attributes: attributes,
                }
            );

            $('#jw-menu-builder .dd-empty').remove();

            $('#jw-menu-builder .dd-list:first').append(menuItemTemplate);
        } else {
            let itemElements = form.find(`.select-all-${formKey}:checked`);
            $('#jw-menu-builder .dd-empty').remove();

            $.each(itemElements, function (index, item) {
                let itemData = {};
                let attributes = '';

                $.each($(item).data(), function (k, v) {
                    itemData[k] = v;
                    attributes += ` data-${k}="${htmlspecialchars(v)}"`;
                });

                let itemHtml = replace_template(templateHtml, itemData);
                let menuItemHtml = replace_template(
                    menuItemTemplate,
                    {
                        slot: itemHtml,
                        label: htmlspecialchars($(item).data('label')),
                        attributes: attributes,
                    }
                );

                $('#jw-menu-builder .dd-list:first').append(menuItemHtml);
            });
        }

        updateOutput($('#jw-menu-builder'));
        form.find('.reset-after-add').each(
            function () {
                if ($(this).is(':checkbox') || $(this).is(':radio')) {
                    $(this).prop('checked', false);
                } else {
                    $(this).val('');
                }
            }
        );

        return false;
    });

    $('#menu-container').on('click', '.btn-add-menu', function () {
        let eForm = $('.form-add-menu');
        if (eForm.is(':hidden')) {
            eForm.show('slow');
        } else {
            eForm.hide('slow');
        }
    });

    $('#menu-container').on('change', '.form-select-menu .load-menu', function () {
        let id = $(this).val();
        if (id) {
            window.location = juzaweb.adminUrl + "/menus/" + id;
        }
    });

    $('#menu-container').on('click', '.card-menu-items .card-header', function () {
        let cardBody = $(this).closest('.card-menu-items').find('.card-body');

        if (cardBody.is(':hidden')) {
            $('.card-menu-items').find('.card-body').slideUp('slow');
            $('.card-menu-items').find('.card-header').removeClass('bg-light');
            $(this).closest('.card-menu-items').find('.card-header').addClass('bg-light');
            cardBody.slideDown('slow');
        } else {
            cardBody.slideUp('slow');
            $(this).closest('.card-menu-items').find('.card-header').removeClass('bg-light');
        }
    });

    $('#menu-container').on('click', '.show-menu-edit', function (e) {
        let formEdit = $(this).closest('.dd-item').find('.form-item-edit').first();
        if (formEdit.is(':hidden')) {
            formEdit.slideDown('slow');
        } else {
            formEdit.slideUp('slow');
        }
    });

    $('#menu-container').on('click', '.delete-menu', function (e) {
        let id = $(this).data('id');
        let name = $(this).data('name');

        confirm_message(
            juzaweb.lang.remove_question.replace(':name', name),
            function (result) {
                if (result) {
                    $.ajax({
                        url: juzaweb.adminUrl + "/menus/" + id,
                        type: 'DELETE',
                        dataType: 'json',
                        success: function (res) {
                            show_message(res);
                            window.location = juzaweb.adminUrl + "/menus";
                        },
                        error: function () {
                            show_notify({success: false, message: 'Error fetching data'});
                        }
                    });
                }
            }
        );
    });

    $('#menu-container').on('change', '.menu-data', function () {
        let name = $(this).data('name');
        let val = $(this).val();

        $(this).closest('li').data(name, val);
        updateOutput($('#jw-menu-builder'));

        if ($(this).hasClass('change-label')) {
            $(this).closest('li').find('.dd-handle span:first').text(val);
        }
    });

    $('#menu-container').on('click', '.delete-menu-item', function () {
        $(this).closest('li').remove();
        updateOutput($('#jw-menu-builder'));
    });

    $('#menu-container').on('click', '.close-menu-item', function () {
        let formEdit = $(this).closest('.dd-item').find('.form-item-edit').first();
        if (formEdit.is(':hidden')) {
            formEdit.slideDown('slow');
        } else {
            formEdit.slideUp('slow');
        }
    });

    $('#menu-container').on('change', '.select-all-checkbox', function () {
        let select = $(this).data('select');
        let checked = $(this).is(':checked');
        $(this).closest('.tab-pane').find('.' + select).prop('checked', checked);
    });

    $('#menu-container').on('keyup', '.menu-box-model-search', function () {
        let search = $(this).val();
        let key = $(this).data('key');
        let resultElement = $(this).closest('.tab-pane').find('.box-tab-search-result');
        let dataUrl = $(this).data('url');
        resultElement.html('');

        if (search.length <= 0) {
            return false;
        }

        $.ajax({
            url: dataUrl,
            type: 'GET',
            dataType: 'json',
            data: {
                q: search,
                per_page: 5
            },
            success: function (res) {
                let temps = '';
                $.each(res.results, function (index, item) {
                    temps += `<div class="form-check mt-1">
                        <label class="form-check-label">
                            <input
                                class="form-check-input reset-after-add select-all-${key}"
                                type="checkbox"
                                name="items[]"
                                value="${item.id}"
                                data-id=""
                                data-key="${key}"
                                data-menuable_id="${item.id}"
                                data-target="_self"
                                data-label="${htmlspecialchars(item.text)}"
                                data-edit_url="${item.edit_url}"
                                data-menuable_class_name="${item.menuable_class_name}"
                                data-menuable_class="${item.menuable_class}"
                            >
                            ${item.text}
                        </label>
                    </div>`;
                });

                resultElement.html(temps);
            },
            error: function () {
                show_notify({success: false, message: 'Error fetching data'});
            }
        });

        return false;
    });
});

$(function () {
    $('.jw-widget-builder').nestable({
        noDragClass: 'dd-nodrag',
        maxDepth: 1,
    });

    $('#widget-container').on('click', '.dropdown-action', function () {
        let $widget = $(this).closest('.widget-block');
        let $blocks = $widget.find('.sidebar-blocks');
        let $icon = $(this).find('.toggle-icon'); // nu c icon

        if ($blocks.is(':visible')) {
            $blocks.slideUp(250);
            $widget.removeClass('open');
            $icon.removeClass('rotated');
        } else {
            $blocks.slideDown(250);
            $widget.addClass('open');
            $icon.addClass('rotated');
        }
    });

    $('#widget-container').on('submit', '.form-add-widget', function (e) {
        e.preventDefault();
        let form = new FormData($(this)[0]);
        let btn = $(this).find('button[type=submit]');
        let icon = btn.find('i').attr('class');
        let widgetKey = form.get('widget');
        let widgetLabel = form.get('widget_label');
        let items = $(this).find('input[name="sidebars[]"]:checked').map(function () {
            return {key: $(this).val()};
        }).get();

        let formTemplate = document.getElementById(`sidebar-widget-form-template`).innerHTML;
        btn.find('i').attr('class', 'fa fa-spinner fa-spin');
        btn.prop("disabled", true);

        $.each(items, function (key, item) {
            let itemKey = uuidv4();
            let form = replace_template(
                document.getElementById(`widget-${widgetKey}-form`).innerHTML,
                {
                    key: itemKey,
                }
            );
            let htm = replace_template(formTemplate, {
                key: itemKey,
                widget_key: widgetKey,
                widget_label: widgetLabel,
                form: form,
            });

            $('#sidebar-' + item.key + ' .jw-widget-builder .dd-empty').remove();
            $('#sidebar-' + item.key + ' .dd-list').append(htm);
        });

        $.each(items, function (key, item) {
            initSelect2('#dd-item-' + item.key);
        });

        btn.find('i').attr('class', icon);
        btn.prop("disabled", false);

        return false;
    });

    $('#widget-container').on('click', '.widget-sidebar-item', function () {
            let item = $(this);
            let isChecked = item.find('input').is(':checked');
            let form = item.closest('.form-add-widget');
            let btn = form.find('button[type=submit]');

            if (isChecked) {
                item.find('span').html('');
                item.find('input').prop('checked', false);
            } else {
                item.find('span').html(`<i class="fa fa-check"></i>`);
                item.find('input').prop('checked', true);
            }

            if (form.find('.widget-sidebar-item input:checked').length > 0) {
                btn.prop('disabled', false);
            } else {
                btn.prop('disabled', true);
            }
        }
    );

    $('#widget-container').on('click', '.show-edit-form', function () {
        let item = $(this);
        let form = item.closest('.sidebar-item').find('.card-body');
        if (form.is(':hidden')) {
            form.show();
        } else {
            form.hide();
        }
    });

    $('#widget-container').on('click', '.show-item-form', function () {
        let editForm = $(this).closest('.dd-item').find('.form-item-edit');
        if (editForm.is(':hidden')) {
            editForm.show();
        } else {
            editForm.hide();
        }
    });

    $('#widget-container').on('click', '.delete-item-form', function () {
        $(this).closest('.dd-item').remove();
    });
});
